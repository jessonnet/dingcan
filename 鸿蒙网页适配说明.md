# 鸿蒙网页适配说明

## 概述

本系统已针对鸿蒙（HarmonyOS）系统进行了网页适配，确保在鸿蒙设备上的浏览器中能够正常显示和使用。

## 适配内容

### 1. 浏览器环境检测

**后端实现**：

在 `WeChatController.java` 中添加了鸿蒙系统检测逻辑：

```java
@GetMapping("/check-browser")
public ResponseEntity<Map<String, Object>> checkBrowser(@RequestHeader("User-Agent") String userAgent) {
    Map<String, Object> result = new HashMap<>();
    
    String userAgentLower = userAgent.toLowerCase();
    boolean isWeChat = userAgentLower.contains("micromessenger");
    boolean isHarmonyOS = userAgentLower.contains("harmonyos") || 
                          userAgentLower.contains("huaweibrowser") || 
                          userAgentLower.contains("huawei");
    
    result.put("success", true);
    result.put("isWeChat", isWeChat);
    result.put("isHarmonyOS", isHarmonyOS);
    result.put("userAgent", userAgent);
    
    return ResponseEntity.ok(result);
}
```

**检测规则**：
- `harmonyos`：检测鸿蒙系统标识
- `huaweibrowser`：检测华为浏览器
- `huawei`：检测华为设备

**前端实现**：

在 `Login.vue` 中添加了鸿蒙系统适配逻辑：

```javascript
const checkBrowser = async () => {
  try {
    const response = await fetch('/api/wechat/check-browser', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    const data = await response.json()
    if (data.success) {
      isWeChat.value = data.isWeChat
      isHarmonyOS.value = data.isHarmonyOS
      
      if (isWeChat.value) {
        loginMode.value = 'wechat'
      } else if (isHarmonyOS.value) {
        loginMode.value = 'password'
      }
    }
  } catch (error) {
    console.error('检测浏览器环境失败:', error)
  }
}
```

### 2. CSS样式适配

#### 2.1 高分辨率屏幕适配

针对鸿蒙设备的高分辨率屏幕，添加了特定的CSS媒体查询：

```css
/* 鸿蒙系统适配 */
@media screen and (-webkit-min-device-pixel-ratio: 2) and (min-resolution: 192dpi) {
  .login-form {
    box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.15);
  }
  
  .login-button,
  .wechat-button {
    border-radius: 8px;
  }
}
```

**适配说明**：
- `-webkit-min-device-pixel-ratio: 2`：检测高DPI屏幕
- `min-resolution: 192dpi`：确保高分辨率设备
- 增强阴影效果，提升视觉层次
- 优化按钮圆角，符合鸿蒙设计规范

#### 2.2 安全区域适配

针对鸿蒙设备的刘海屏和挖孔屏，添加了安全区域适配：

```css
/* 鸿蒙系统安全区域适配 */
@supports (padding: max(0px)) {
  .login-container {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
}
```

**适配说明**：
- `@supports (padding: max(0px))`：检测浏览器是否支持安全区域
- `env(safe-area-inset-left)`：左侧安全区域（如刘海屏）
- `env(safe-area-inset-right)`：右侧安全区域（如挖孔屏）
- 避免内容被刘海或挖孔遮挡

### 3. 已适配的页面

#### 3.1 登录页面（Login.vue）

**适配内容**：
- ✅ 鸿蒙系统检测
- ✅ 高分辨率屏幕适配
- ✅ 安全区域适配
- ✅ 登录模式自动切换（鸿蒙设备默认使用账号密码登录）

#### 3.2 微信授权回调页面（WeChatCallback.vue）

**适配内容**：
- ✅ 高分辨率屏幕适配
- ✅ 安全区域适配
- ✅ 加载状态优化
- ✅ 错误提示优化

#### 3.3 员工订餐页面（employee/Order.vue）

**适配内容**：
- ✅ 高分辨率屏幕适配
- ✅ 安全区域适配
- ✅ 卡片阴影优化
- ✅ 按钮样式优化

#### 3.4 管理员布局页面（admin/Layout.vue）

**适配内容**：
- ✅ 高分辨率屏幕适配
- ✅ 安全区域适配
- ✅ 侧边栏适配
- ✅ 顶部导航适配
- ✅ 下拉菜单优化

## 鸿蒙系统特性

### 1. 浏览器特性

鸿蒙系统自带的浏览器具有以下特性：
- 基于 Chromium 内核
- 支持现代 Web 标准
- 支持安全区域 API
- 支持高分辨率显示
- 支持触摸手势

### 2. 设计规范

鸿蒙系统遵循以下设计规范：
- 圆角设计：8px-12px
- 阴影效果：柔和的阴影
- 间距规范：8px/16px/24px
- 字体大小：14px/16px/18px
- 颜色规范：使用系统默认颜色

### 3. 交互特性

鸿蒙系统的交互特性：
- 触摸反馈：点击时有视觉反馈
- 滚动效果：流畅的滚动动画
- 过渡动画：平滑的页面切换
- 加载状态：明确的加载提示

## 测试建议

### 1. 测试设备

推荐在以下设备上测试：
- 华为 Mate 系列
- 华为 P 系列
- 华为 nova 系列
- 华为畅享系列
- 荣耀系列

### 2. 测试浏览器

推荐在以下浏览器中测试：
- 华为浏览器
- 微信内置浏览器
- QQ浏览器
- UC浏览器
- Chrome浏览器

### 3. 测试场景

重点测试以下场景：
- ✅ 登录页面显示
- ✅ 表单输入体验
- ✅ 按钮点击反馈
- ✅ 页面滚动效果
- ✅ 安全区域适配
- ✅ 高分辨率显示
- ✅ 触摸手势操作
- ✅ 页面切换动画

### 4. 测试方法

#### 4.1 模拟器测试

使用鸿蒙模拟器进行测试：

```bash
# 启动鸿蒙模拟器
hdc shell

# 打开浏览器
am start -n com.huawei.browser/.BrowserActivity

# 访问测试地址
# http://your-domain.com
```

#### 4.2 真机测试

使用真机进行测试：

1. 连接鸿蒙设备
2. 打开浏览器
3. 访问系统地址
4. 测试各项功能
5. 记录问题和建议

#### 4.3 远程调试

使用 DevTools 进行远程调试：

```bash
# 启用远程调试
hdc shell settings put global webview_debug 1

# 查看设备信息
hdc list targets

# 转发调试端口
hdc fport tcp:9222 tcp:9222
```

## 常见问题

### Q1: 鸿蒙设备上页面显示异常

**A:** 检查以下几点：
1. 浏览器版本是否过旧
2. 是否启用了兼容模式
3. 检查 CSS 媒体查询是否生效
4. 查看浏览器控制台错误信息

### Q2: 安全区域适配不生效

**A:** 检查以下几点：
1. 浏览器是否支持 `env()` 函数
2. 检查 `@supports` 查询是否正确
3. 确认设备是否有刘海或挖孔
4. 查看实际的安全区域值

### Q3: 高分辨率显示模糊

**A:** 检查以下几点：
1. 是否使用了正确的媒体查询
2. 检查图片是否使用了高分辨率版本
3. 确认字体大小是否合适
4. 查看设备像素比设置

### Q4: 触摸操作不流畅

**A:** 检查以下几点：
1. 是否添加了触摸事件监听
2. 检查 CSS 动画是否流畅
3. 确认是否有 JavaScript 阻塞
4. 查看页面渲染性能

### Q5: 微信登录在鸿蒙设备上不可用

**A:** 这是正常现象：
- 鸿蒙设备默认使用账号密码登录
- 微信登录仅在微信内置浏览器中可用
- 用户可以手动切换登录方式

## 兼容性说明

### 支持的鸿蒙版本

- ✅ HarmonyOS 2.0+
- ✅ HarmonyOS 3.0+
- ✅ HarmonyOS 4.0+

### 支持的浏览器版本

- ✅ 华为浏览器 10.0+
- ✅ Chrome 80+
- ✅ 微信内置浏览器 7.0+
- ✅ QQ浏览器 10.0+
- ✅ UC浏览器 13.0+

### 不支持的特性

- ❌ IE 浏览器（鸿蒙系统不包含）
- ❌ 过时的浏览器（如 UC Browser 旧版本）
- ❌ 不支持 ES6 的浏览器

## 性能优化

### 1. CSS 优化

- 使用硬件加速：`transform: translateZ(0)`
- 避免重排：使用 `position: absolute`
- 优化动画：使用 `will-change` 属性
- 减少重绘：使用 `opacity` 代替 `visibility`

### 2. JavaScript 优化

- 使用事件委托：减少事件监听器数量
- 防抖节流：优化频繁触发的事件
- 懒加载：延迟加载非关键资源
- 代码分割：按需加载 JavaScript 模块

### 3. 资源优化

- 图片优化：使用 WebP 格式
- 字体优化：使用系统字体
- 压缩资源：使用 Gzip 压缩
- CDN 加速：使用 CDN 分发资源

## 更新日志

### V1.2.0 (2026-02-06)

**新增功能**：
- ✅ 鸿蒙系统检测
- ✅ 高分辨率屏幕适配
- ✅ 安全区域适配
- ✅ 登录页面适配
- ✅ 微信授权回调页面适配
- ✅ 员工订餐页面适配
- ✅ 管理员布局页面适配

**优化内容**：
- ✅ 优化阴影效果
- ✅ 优化按钮圆角
- ✅ 优化页面布局
- ✅ 优化触摸反馈

## 技术支持

如有问题，请通过以下方式联系：
- GitHub Issues: https://github.com/jessonnet/dingcan/issues
- 部署指南: [部署指南.md](./部署指南.md)
- 双登录功能说明: [双登录功能说明.md](./双登录功能说明.md)

## 参考资料

- [鸿蒙开发者文档](https://developer.harmonyos.com/cn/)
- [鸿蒙 Web 开发指南](https://developer.harmonyos.com/cn/docs/documentation/doc-guides/web-overview-0000000000000001)
- [CSS 安全区域规范](https://www.w3.org/TR/css-env-1/)
- [CSS 媒体查询规范](https://www.w3.org/TR/css3-mediaqueries/)

## 许可证

本项目采用 MIT 许可证。
