import{o as N,r as i,c as S,d as T,f as l,w as t,h as m,b as V,E as r,e as _,j as n,t as b,_ as q}from"./index-c314a4a7.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";const I={class:"role-container"},j={class:"card-header"},G={class:"role-content"},H={class:"dialog-footer"},J={class:"dialog-footer"},K={__name:"Role",setup(L){const k=m([]),c=m(!1),v=m(null),u=m({name:"",description:""}),f=m(!1),x=m(null),p=m({id:"",name:"",description:""}),C={name:[{required:!0,message:"请输入角色名称",trigger:"change"}],description:[{required:!0,message:"请输入角色描述",trigger:"change"}]},g=async()=>{try{const a=await V.get("/api/admin/role/list");a.success?k.value=a.data:r.error("加载角色失败")}catch{r.error("加载角色失败，请检查网络连接")}},E=async()=>{v.value&&await v.value.validate(async a=>{if(a)try{const e=await V.post("/api/admin/role/add",u.value);e.success?(r.success(e.message),c.value=!1,u.value={name:"",description:""},v.value.resetFields(),g()):r.error(e.message)}catch{r.error("添加失败，请检查网络连接")}})},U=a=>{p.value={id:a.id,name:a.name,description:a.description},f.value=!0},$=async()=>{x.value&&await x.value.validate(async a=>{if(a)try{const e=await V.put("/api/admin/role/update",p.value);e.success?(r.success(e.message),f.value=!1,g()):r.error(e.message)}catch{r.error("编辑失败，请检查网络连接")}})},D=async a=>{var e,d;try{await q.confirm("确定要删除该角色吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const s=await V.delete(`/api/admin/role/delete/${a}`);s.success?(r.success(s.message),g()):r.error(s.message)}catch(s){if(s!=="cancel"){console.error("删除角色失败:",s);const R=s.message||((d=(e=s.response)==null?void 0:e.data)==null?void 0:d.message)||"删除失败，请检查网络连接";r.error(R)}}};return N(()=>{g()}),(a,e)=>{const d=i("el-button"),s=i("el-table-column"),R=i("el-table"),M=i("el-card"),y=i("el-input"),w=i("el-form-item"),F=i("el-form"),B=i("el-dialog");return S(),T("div",I,[l(M,null,{header:t(()=>[_("div",j,[e[10]||(e[10]=_("span",null,"角色管理",-1)),l(d,{type:"primary",onClick:e[0]||(e[0]=o=>c.value=!0)},{default:t(()=>[...e[9]||(e[9]=[n("添加角色",-1)])]),_:1})])]),default:t(()=>[_("div",G,[l(R,{data:k.value,style:{width:"100%"}},{default:t(()=>[l(s,{prop:"id",label:"ID",width:"80"},{default:t(o=>[n(b(o.row.id),1)]),_:1}),l(s,{prop:"name",label:"角色名称",width:"180"},{default:t(o=>[n(b(o.row.name),1)]),_:1}),l(s,{prop:"description",label:"角色描述"},{default:t(o=>[n(b(o.row.description),1)]),_:1}),l(s,{prop:"createdAt",label:"创建时间",width:"200"},{default:t(o=>[n(b(o.row.createdAt),1)]),_:1}),l(s,{label:"操作",width:"150"},{default:t(o=>[l(d,{type:"primary",size:"small",onClick:A=>U(o.row)},{default:t(()=>[...e[11]||(e[11]=[n("编辑",-1)])]),_:1},8,["onClick"]),l(d,{type:"danger",size:"small",onClick:A=>D(o.row.id)},{default:t(()=>[...e[12]||(e[12]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),l(B,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=o=>c.value=o),title:"添加角色",width:"500px"},{footer:t(()=>[_("span",H,[l(d,{onClick:e[3]||(e[3]=o=>c.value=!1)},{default:t(()=>[...e[13]||(e[13]=[n("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:E},{default:t(()=>[...e[14]||(e[14]=[n("确定",-1)])]),_:1})])]),default:t(()=>[l(F,{model:u.value,rules:C,ref_key:"addRoleFormRef",ref:v,"label-width":"100px"},{default:t(()=>[l(w,{label:"角色名称",prop:"name"},{default:t(()=>[l(y,{modelValue:u.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value.name=o),placeholder:"输入角色名称"},null,8,["modelValue"])]),_:1}),l(w,{label:"角色描述",prop:"description"},{default:t(()=>[l(y,{modelValue:u.value.description,"onUpdate:modelValue":e[2]||(e[2]=o=>u.value.description=o),placeholder:"输入角色描述",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(B,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=o=>f.value=o),title:"编辑角色",width:"500px"},{footer:t(()=>[_("span",J,[l(d,{onClick:e[7]||(e[7]=o=>f.value=!1)},{default:t(()=>[...e[15]||(e[15]=[n("取消",-1)])]),_:1}),l(d,{type:"primary",onClick:$},{default:t(()=>[...e[16]||(e[16]=[n("确定",-1)])]),_:1})])]),default:t(()=>[l(F,{model:p.value,rules:C,ref_key:"editRoleFormRef",ref:x,"label-width":"100px"},{default:t(()=>[l(w,{label:"角色名称",prop:"name"},{default:t(()=>[l(y,{modelValue:p.value.name,"onUpdate:modelValue":e[5]||(e[5]=o=>p.value.name=o),placeholder:"输入角色名称"},null,8,["modelValue"])]),_:1}),l(w,{label:"角色描述",prop:"description"},{default:t(()=>[l(y,{modelValue:p.value.description,"onUpdate:modelValue":e[6]||(e[6]=o=>p.value.description=o),placeholder:"输入角色描述",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Q=z(K,[["__scopeId","data-v-339ee16d"]]);export{Q as default};
