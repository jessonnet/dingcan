import{u as O,g as z,h as A,i as Q,r as s,o as W,j as X,w as n,b as e,a as r,k as d,t as Y,f as k,l as v,d as P,E as u,m as C,n as Z,p as $,s as ee,q as S,v as oe,G as ne,H as ae,I as le,J as se,K as te,L as re}from"./index-cf2541ee.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const ue={class:"header-right"},ie={class:"username-dropdown"},me={class:"username"},ce={class:"dialog-footer"},pe={__name:"Layout",setup(_e){const _=O(),L=z();let f={};try{f=JSON.parse(localStorage.getItem("user")||"{}")}catch{f={}}const B=P(f),D=A(()=>L.path),I=t=>{_.push(t)},E=t=>{t==="changePassword"?M():t==="logout"&&h()},K=t=>{t?document.addEventListener("click",y):document.removeEventListener("click",y)},y=t=>{const o=document.querySelector(".el-dropdown");o&&!o.contains(t.target)&&o.classList.remove("is-active")},c=P(!1),a=P({currentPassword:"",newPassword:"",confirmPassword:""}),M=()=>{a.value={currentPassword:"",newPassword:"",confirmPassword:""},c.value=!0},N=()=>{c.value=!1,a.value={currentPassword:"",newPassword:"",confirmPassword:""}},p=async()=>{var t,o;if(!a.value.currentPassword){u.warning("请输入当前密码");return}if(!a.value.newPassword){u.warning("请输入新密码");return}if(a.value.newPassword.length<6){u.warning("新密码长度不能少于6位");return}if(a.value.newPassword!==a.value.confirmPassword){u.warning("两次输入的新密码不一致");return}try{const l=await C.post("/api/auth/change-password",{currentPassword:a.value.currentPassword,newPassword:a.value.newPassword});l.data.success?(u.success("密码修改成功，请重新登录"),c.value=!1,a.value={currentPassword:"",newPassword:"",confirmPassword:""},h()):u.error(l.data.message||"密码修改失败")}catch(l){u.error(((o=(t=l.response)==null?void 0:t.data)==null?void 0:o.message)||"密码修改失败，请稍后重试")}},h=async()=>{try{await Z.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.post("/api/auth/logout"),localStorage.removeItem("token"),localStorage.removeItem("user"),_.push("/login"),u.success("登出成功")}catch(t){t!=="cancel"&&u.error("登出失败")}};return Q(()=>{localStorage.getItem("token")||_.push("/login")}),(t,o)=>{const l=s("el-icon"),x=s("el-dropdown-item"),U=s("el-dropdown-menu"),T=s("el-dropdown"),q=s("el-header"),i=s("el-menu-item"),J=s("el-menu"),R=s("el-aside"),j=s("router-view"),F=s("el-main"),V=s("el-container"),w=s("el-input"),g=s("el-form-item"),G=s("el-form"),b=s("el-button"),H=s("el-dialog");return W(),X(V,null,{default:n(()=>[e(q,null,{default:n(()=>[o[6]||(o[6]=r("div",{class:"header-left"},[r("h1",null,"单位内部饭堂订餐系统")],-1)),r("div",ue,[e(T,{trigger:"click",onCommand:E,onVisibleChange:K},{dropdown:n(()=>[e(U,null,{default:n(()=>[e(x,{command:"changePassword"},{default:n(()=>[e(l,null,{default:n(()=>[e(d($))]),_:1}),o[4]||(o[4]=r("span",null,"修改密码",-1))]),_:1}),e(x,{command:"logout",divided:""},{default:n(()=>[e(l,null,{default:n(()=>[e(d(ee))]),_:1}),o[5]||(o[5]=r("span",null,"退出登录",-1))]),_:1})]),_:1})]),default:n(()=>[r("span",ie,[e(l,{class:"user-icon"},{default:n(()=>[e(d(S))]),_:1}),r("span",me,Y(B.value.name),1),e(l,{class:"arrow-icon"},{default:n(()=>[e(d(oe))]),_:1})])]),_:1})])]),_:1}),e(V,null,{default:n(()=>[e(R,{width:"200px"},{default:n(()=>[e(J,{"default-active":D.value,class:"el-menu-vertical-demo",onSelect:I},{default:n(()=>[e(i,{index:"/admin/system-config"},{default:n(()=>[e(l,null,{default:n(()=>[e(d(ne))]),_:1}),o[7]||(o[7]=r("span",null,"系统配置",-1))]),_:1}),e(i,{index:"/admin/meal-type"},{default:n(()=>[e(l,null,{default:n(()=>[e(d(ae))]),_:1}),o[8]||(o[8]=r("span",null,"餐食类型管理",-1))]),_:1}),e(i,{index:"/admin/employee"},{default:n(()=>[e(l,null,{default:n(()=>[e(d(S))]),_:1}),o[9]||(o[9]=r("span",null,"员工管理",-1))]),_:1}),e(i,{index:"/admin/department"},{default:n(()=>[e(l,null,{default:n(()=>[e(d(le))]),_:1}),o[10]||(o[10]=r("span",null,"部门设置",-1))]),_:1}),e(i,{index:"/admin/role"},{default:n(()=>[e(l,null,{default:n(()=>[e(d(se))]),_:1}),o[11]||(o[11]=r("span",null,"角色管理",-1))]),_:1}),e(i,{index:"/admin/order-manage"},{default:n(()=>[e(l,null,{default:n(()=>[e(d(te))]),_:1}),o[12]||(o[12]=r("span",null,"订单管理",-1))]),_:1}),e(i,{index:"/admin/operation-log"},{default:n(()=>[e(l,null,{default:n(()=>[e(d(re))]),_:1}),o[13]||(o[13]=r("span",null,"日志查询",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(F,null,{default:n(()=>[e(j)]),_:1})]),_:1}),e(H,{modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=m=>c.value=m),title:"修改密码",width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[r("span",ce,[e(b,{onClick:N},{default:n(()=>[...o[14]||(o[14]=[k("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:p},{default:n(()=>[...o[15]||(o[15]=[k("确定",-1)])]),_:1})])]),default:n(()=>[e(G,{model:a.value,"label-width":"100px"},{default:n(()=>[e(g,{label:"当前密码"},{default:n(()=>[e(w,{modelValue:a.value.currentPassword,"onUpdate:modelValue":o[0]||(o[0]=m=>a.value.currentPassword=m),type:"password",placeholder:"请输入当前密码","show-password":"",onKeyup:v(p,["enter"])},null,8,["modelValue"])]),_:1}),e(g,{label:"新密码"},{default:n(()=>[e(w,{modelValue:a.value.newPassword,"onUpdate:modelValue":o[1]||(o[1]=m=>a.value.newPassword=m),type:"password",placeholder:"请输入新密码（至少6位）","show-password":"",onKeyup:v(p,["enter"])},null,8,["modelValue"])]),_:1}),e(g,{label:"确认新密码"},{default:n(()=>[e(w,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=m=>a.value.confirmPassword=m),type:"password",placeholder:"请再次输入新密码","show-password":"",onKeyup:v(p,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}},ge=de(pe,[["__scopeId","data-v-977c5f76"]]);export{ge as default};
