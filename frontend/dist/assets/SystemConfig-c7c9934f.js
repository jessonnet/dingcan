import{o as I,r,c as $,d as U,f as o,w as n,b as w,E as d,e as m,j as f,h as p,_ as D}from"./index-c314a4a7.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";const R={class:"system-config-container"},q={class:"system-config-content"},j={__name:"SystemConfig",setup(K){const h=p(null),E=p(null),C=p("basic"),c=p({lockTime:"",systemName:""}),u=p({wechatLoginEnabled:!0,wechatLoginMode:"auto"}),_=p({lock_time:"",system_name:""}),T={lockTime:[{required:!0,message:"请选择锁单时间",trigger:"change"}],systemName:[{required:!0,message:"请输入系统名称",trigger:"change"}]},y=async()=>{try{console.log("开始加载系统配置");const a=await w.get("/api/admin/system-config/list");if(console.log("加载系统配置响应:",a),a.success){const e=a.data;console.log("系统配置数据:",e);for(const t of e)if(t.configKey==="lock_time"){_.value.lock_time=t.id;const l=t.configValue.split(":"),i=new Date;i.setHours(parseInt(l[0]),parseInt(l[1]),0,0),c.value.lockTime=i}else t.configKey==="system_name"?(_.value.system_name=t.id,c.value.systemName=t.configValue):t.configKey==="wechat_login_enabled"?u.value.wechatLoginEnabled=t.configValue==="1":t.configKey==="wechat_login_mode"&&(u.value.wechatLoginMode=t.configValue)}else d.error("加载系统配置失败")}catch(a){console.error("加载系统配置失败:",a),d.error("加载系统配置失败，请检查网络连接")}},k=async(a,e)=>{try{console.log("开始更新系统配置:",a,e);let t=e;if(a==="lock_time"&&e instanceof Date){const v=e.getHours().toString().padStart(2,"0"),g=e.getMinutes().toString().padStart(2,"0");t=`${v}:${g}`}const l=_.value[a];if(console.log("配置项 ID:",l),!l){d.error("未找到配置项的 ID，请重新加载页面");return}console.log("准备发送更新请求:",{id:l,configKey:a,configValue:t});const i=await w.put("/api/admin/system-config/update",{id:l,configKey:a,configValue:t});console.log("更新系统配置响应:",i),i.success?d.success(i.message):d.error(i.message)}catch(t){console.error("更新系统配置失败:",t),d.error("更新系统配置失败，请检查网络连接")}},x=async(a,e,t)=>{try{console.log("开始更新登录配置:",a,e);const l=await w.post("/api/system/config/update",{configKey:a,configValue:e,description:t});console.log("更新登录配置响应:",l),l.success?d.success(l.message):(d.error(l.message),await y())}catch(l){console.error("更新登录配置失败:",l),d.error("更新登录配置失败，请检查网络连接"),await y()}},N=async a=>{if(!a)try{await D.confirm("禁用微信登录功能后，用户只能使用账号密码登录。确定要禁用吗？","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{u.value.wechatLoginEnabled=!0;return}};return I(()=>{y()}),(a,e)=>{const t=r("el-time-picker"),l=r("el-button"),i=r("el-form-item"),v=r("el-input"),g=r("el-form"),V=r("el-tab-pane"),M=r("el-switch"),L=r("el-alert"),b=r("el-option"),S=r("el-select"),B=r("el-tabs"),F=r("el-card");return $(),U("div",R,[o(F,null,{header:n(()=>[...e[9]||(e[9]=[m("div",{class:"card-header"},[m("span",null,"系统配置")],-1)])]),default:n(()=>[m("div",q,[o(B,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=s=>C.value=s),type:"border-card"},{default:n(()=>[o(V,{label:"基础配置",name:"basic"},{default:n(()=>[o(g,{model:c.value,rules:T,ref_key:"systemConfigFormRef",ref:h,"label-width":"150px"},{default:n(()=>[o(i,{label:"锁单时间",prop:"lockTime"},{default:n(()=>[o(t,{modelValue:c.value.lockTime,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value.lockTime=s),format:"HH:mm",placeholder:"选择锁单时间",style:{width:"150px"}},null,8,["modelValue"]),o(l,{type:"primary",onClick:e[1]||(e[1]=s=>k("lock_time",c.value.lockTime)),style:{"margin-left":"10px"}},{default:n(()=>[...e[10]||(e[10]=[f("保存",-1)])]),_:1})]),_:1}),o(i,{label:"系统名称",prop:"systemName"},{default:n(()=>[o(v,{modelValue:c.value.systemName,"onUpdate:modelValue":e[2]||(e[2]=s=>c.value.systemName=s),placeholder:"输入系统名称",style:{width:"300px"}},null,8,["modelValue"]),o(l,{type:"primary",onClick:e[3]||(e[3]=s=>k("system_name",c.value.systemName)),style:{"margin-left":"10px"}},{default:n(()=>[...e[11]||(e[11]=[f("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(V,{label:"登录配置",name:"login"},{default:n(()=>[o(g,{model:u.value,ref_key:"loginConfigFormRef",ref:E,"label-width":"150px"},{default:n(()=>[o(i,{label:"微信登录功能"},{default:n(()=>[o(M,{modelValue:u.value.wechatLoginEnabled,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.wechatLoginEnabled=s),"active-text":"启用","inactive-text":"禁用",onChange:N},null,8,["modelValue"]),o(l,{type:"primary",onClick:e[5]||(e[5]=s=>x("wechat_login_enabled",u.value.wechatLoginEnabled?"1":"0","微信登录功能开关")),style:{"margin-left":"10px"}},{default:n(()=>[...e[12]||(e[12]=[f("保存",-1)])]),_:1})]),_:1}),o(L,{title:"功能说明",type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:n(()=>[...e[13]||(e[13]=[m("p",null,"启用微信登录功能后，用户可以通过微信快速登录系统。禁用后，用户只能使用账号密码登录。",-1),m("p",null,"建议在微信环境（如企业微信、微信内置浏览器）中启用此功能。",-1)])]),_:1}),o(i,{label:"微信登录模式"},{default:n(()=>[o(S,{modelValue:u.value.wechatLoginMode,"onUpdate:modelValue":e[6]||(e[6]=s=>u.value.wechatLoginMode=s),placeholder:"选择登录模式",style:{width:"200px"}},{default:n(()=>[o(b,{label:"自动检测",value:"auto"}),o(b,{label:"强制微信",value:"force"}),o(b,{label:"手动选择",value:"manual"})]),_:1},8,["modelValue"]),o(l,{type:"primary",onClick:e[7]||(e[7]=s=>x("wechat_login_mode",u.value.wechatLoginMode,"微信登录模式")),style:{"margin-left":"10px"}},{default:n(()=>[...e[14]||(e[14]=[f("保存",-1)])]),_:1})]),_:1}),o(L,{title:"模式说明",type:"info",closable:!1},{default:n(()=>[...e[15]||(e[15]=[m("ul",null,[m("li",null,[m("strong",null,"自动检测"),f("：系统自动检测浏览器环境，微信环境优先使用微信登录")]),m("li",null,[m("strong",null,"强制微信"),f("：所有用户必须使用微信登录（适用于纯微信环境）")]),m("li",null,[m("strong",null,"手动选择"),f("：用户可以自由选择登录方式（适用于混合环境）")])],-1)])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])]),_:1})])}}},z=H(j,[["__scopeId","data-v-34b2a67f"]]);export{z as default};
