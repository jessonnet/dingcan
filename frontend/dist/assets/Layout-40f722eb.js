import{u as R,V as j,g as q,r as t,o as F,c as J,b as e,w as s,d as f,a as d,i as m,t as O,f as k,W as g,E as r,j as C,X as W,l as X,s as z,k as A,m as G}from"./index-bda5bdc9.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";const Q={class:"chef-layout"},Y={class:"header-right"},Z={class:"username-dropdown"},$={class:"username"},ee={class:"dialog-footer"},oe={__name:"Layout",setup(se){const v=R();j();let w={};try{w=JSON.parse(localStorage.getItem("user")||"{}")}catch{w={}}const b=f(w),x=n=>{n==="changePassword"?L():n==="logout"&&h()},S=n=>{n?document.addEventListener("click",P):document.removeEventListener("click",P)},P=n=>{const o=document.querySelector(".el-dropdown");o&&!o.contains(n.target)&&o.classList.remove("is-active")},c=f(!1),a=f({currentPassword:"",newPassword:"",confirmPassword:""}),L=()=>{a.value={currentPassword:"",newPassword:"",confirmPassword:""},c.value=!0},B=()=>{c.value=!1,a.value={currentPassword:"",newPassword:"",confirmPassword:""}},i=async()=>{var n,o;if(!a.value.currentPassword){r.warning("请输入当前密码");return}if(!a.value.newPassword){r.warning("请输入新密码");return}if(a.value.newPassword.length<6){r.warning("新密码长度不能少于6位");return}if(a.value.newPassword!==a.value.confirmPassword){r.warning("两次输入的新密码不一致");return}try{const l=await C.post("/api/auth/change-password",{currentPassword:a.value.currentPassword,newPassword:a.value.newPassword});l.success?(r.success("密码修改成功，请重新登录"),c.value=!1,a.value={currentPassword:"",newPassword:"",confirmPassword:""},h()):r.error(l.message||"密码修改失败")}catch(l){r.error(((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.message)||"密码修改失败，请稍后重试")}},h=async()=>{try{await W.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.post("/api/auth/logout"),localStorage.removeItem("token"),localStorage.removeItem("user"),v.push("/login"),r.success("登出成功")}catch(n){n!=="cancel"&&r.error("登出失败")}};return q(()=>{localStorage.getItem("token")||v.push("/login")}),(n,o)=>{const l=t("el-icon"),y=t("el-dropdown-item"),D=t("el-dropdown-menu"),E=t("el-dropdown"),I=t("el-header"),K=t("router-view"),N=t("el-main"),U=t("el-container"),_=t("el-input"),p=t("el-form-item"),M=t("el-form"),V=t("el-button"),T=t("el-dialog");return F(),J("div",Q,[e(U,{class:"main-container"},{default:s(()=>[e(I,{class:"header"},{default:s(()=>[o[6]||(o[6]=d("div",{class:"header-left"},[d("h1",null,"单位内部饭堂订餐系统")],-1)),d("div",Y,[e(E,{trigger:"click",onCommand:x,onVisibleChange:S},{dropdown:s(()=>[e(D,null,{default:s(()=>[e(y,{command:"changePassword"},{default:s(()=>[e(l,null,{default:s(()=>[e(m(X))]),_:1}),o[4]||(o[4]=d("span",null,"修改密码",-1))]),_:1}),e(y,{command:"logout",divided:""},{default:s(()=>[e(l,null,{default:s(()=>[e(m(z))]),_:1}),o[5]||(o[5]=d("span",null,"退出登录",-1))]),_:1})]),_:1})]),default:s(()=>[d("span",Z,[e(l,{class:"user-icon"},{default:s(()=>[e(m(A))]),_:1}),d("span",$,O(b.value.name),1),e(l,{class:"arrow-icon"},{default:s(()=>[e(m(G))]),_:1})])]),_:1})])]),_:1}),e(N,{class:"main-content"},{default:s(()=>[e(K)]),_:1})]),_:1}),e(T,{modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=u=>c.value=u),title:"修改密码",width:"90%","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:s(()=>[d("span",ee,[e(V,{onClick:B},{default:s(()=>[...o[7]||(o[7]=[k("取消",-1)])]),_:1}),e(V,{type:"primary",onClick:i},{default:s(()=>[...o[8]||(o[8]=[k("确定",-1)])]),_:1})])]),default:s(()=>[e(M,{model:a.value,"label-width":"100px"},{default:s(()=>[e(p,{label:"当前密码"},{default:s(()=>[e(_,{modelValue:a.value.currentPassword,"onUpdate:modelValue":o[0]||(o[0]=u=>a.value.currentPassword=u),type:"password",placeholder:"请输入当前密码","show-password":"",onKeyup:g(i,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"新密码"},{default:s(()=>[e(_,{modelValue:a.value.newPassword,"onUpdate:modelValue":o[1]||(o[1]=u=>a.value.newPassword=u),type:"password",placeholder:"请输入新密码（至少6位）","show-password":"",onKeyup:g(i,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"确认新密码"},{default:s(()=>[e(_,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=u=>a.value.confirmPassword=u),type:"password",placeholder:"请再次输入新密码","show-password":"",onKeyup:g(i,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},te=H(oe,[["__scopeId","data-v-565ce993"]]);export{te as default};
