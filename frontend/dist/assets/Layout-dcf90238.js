import{u as W,V as X,v as Y,g as Z,r as s,o as $,h as z,w as n,b as e,a as t,i as r,t as A,f as k,W as v,d as P,E as u,j as C,X as G,l as Q,s as ee,k as S,m as oe,Y as ne,J as ae,Z as le,_ as se,$ as te,H as de,a0 as re}from"./index-bda5bdc9.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";const ie={class:"header-right"},me={class:"username-dropdown"},_e={class:"username"},pe={class:"dialog-footer"},ce={__name:"Layout",setup(fe){const c=W(),L=X();let f={};try{f=JSON.parse(localStorage.getItem("user")||"{}")}catch{f={}}const B=P(f),D=Y(()=>L.path),E=d=>{c.push(d)},I=d=>{d==="changePassword"?K():d==="logout"&&x()},M=d=>{d?document.addEventListener("click",y):document.removeEventListener("click",y)},y=d=>{const o=document.querySelector(".el-dropdown");o&&!o.contains(d.target)&&o.classList.remove("is-active")},_=P(!1),a=P({currentPassword:"",newPassword:"",confirmPassword:""}),K=()=>{a.value={currentPassword:"",newPassword:"",confirmPassword:""},_.value=!0},N=()=>{_.value=!1,a.value={currentPassword:"",newPassword:"",confirmPassword:""}},p=async()=>{var d,o;if(!a.value.currentPassword){u.warning("请输入当前密码");return}if(!a.value.newPassword){u.warning("请输入新密码");return}if(a.value.newPassword.length<6){u.warning("新密码长度不能少于6位");return}if(a.value.newPassword!==a.value.confirmPassword){u.warning("两次输入的新密码不一致");return}try{const l=await C.post("/api/auth/change-password",{currentPassword:a.value.currentPassword,newPassword:a.value.newPassword});l.data.success?(u.success("密码修改成功，请重新登录"),_.value=!1,a.value={currentPassword:"",newPassword:"",confirmPassword:""},x()):u.error(l.data.message||"密码修改失败")}catch(l){u.error(((o=(d=l.response)==null?void 0:d.data)==null?void 0:o.message)||"密码修改失败，请稍后重试")}},x=async()=>{try{await G.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.post("/api/auth/logout"),localStorage.removeItem("token"),localStorage.removeItem("user"),c.push("/login"),u.success("登出成功")}catch(d){d!=="cancel"&&u.error("登出失败")}};return Z(()=>{localStorage.getItem("token")||c.push("/login")}),(d,o)=>{const l=s("el-icon"),V=s("el-dropdown-item"),U=s("el-dropdown-menu"),T=s("el-dropdown"),J=s("el-header"),i=s("el-menu-item"),R=s("el-menu"),j=s("el-aside"),q=s("router-view"),F=s("el-main"),h=s("el-container"),w=s("el-input"),g=s("el-form-item"),H=s("el-form"),b=s("el-button"),O=s("el-dialog");return $(),z(h,null,{default:n(()=>[e(J,null,{default:n(()=>[o[6]||(o[6]=t("div",{class:"header-left"},[t("h1",null,"单位内部饭堂订餐系统")],-1)),t("div",ie,[e(T,{trigger:"click",onCommand:I,onVisibleChange:M},{dropdown:n(()=>[e(U,null,{default:n(()=>[e(V,{command:"changePassword"},{default:n(()=>[e(l,null,{default:n(()=>[e(r(Q))]),_:1}),o[4]||(o[4]=t("span",null,"修改密码",-1))]),_:1}),e(V,{command:"logout",divided:""},{default:n(()=>[e(l,null,{default:n(()=>[e(r(ee))]),_:1}),o[5]||(o[5]=t("span",null,"退出登录",-1))]),_:1})]),_:1})]),default:n(()=>[t("span",me,[e(l,{class:"user-icon"},{default:n(()=>[e(r(S))]),_:1}),t("span",_e,A(B.value.name),1),e(l,{class:"arrow-icon"},{default:n(()=>[e(r(oe))]),_:1})])]),_:1})])]),_:1}),e(h,null,{default:n(()=>[e(j,{width:"200px"},{default:n(()=>[e(R,{"default-active":D.value,class:"el-menu-vertical-demo",onSelect:E},{default:n(()=>[e(i,{index:"/admin/system-config"},{default:n(()=>[e(l,null,{default:n(()=>[e(r(ne))]),_:1}),o[7]||(o[7]=t("span",null,"系统配置",-1))]),_:1}),e(i,{index:"/admin/meal-type"},{default:n(()=>[e(l,null,{default:n(()=>[e(r(ae))]),_:1}),o[8]||(o[8]=t("span",null,"餐食类型管理",-1))]),_:1}),e(i,{index:"/admin/employee"},{default:n(()=>[e(l,null,{default:n(()=>[e(r(S))]),_:1}),o[9]||(o[9]=t("span",null,"员工管理",-1))]),_:1}),e(i,{index:"/admin/department"},{default:n(()=>[e(l,null,{default:n(()=>[e(r(le))]),_:1}),o[10]||(o[10]=t("span",null,"部门设置",-1))]),_:1}),e(i,{index:"/admin/restaurant"},{default:n(()=>[e(l,null,{default:n(()=>[e(r(se))]),_:1}),o[11]||(o[11]=t("span",null,"餐厅管理",-1))]),_:1}),e(i,{index:"/admin/role"},{default:n(()=>[e(l,null,{default:n(()=>[e(r(te))]),_:1}),o[12]||(o[12]=t("span",null,"角色管理",-1))]),_:1}),e(i,{index:"/admin/order-manage"},{default:n(()=>[e(l,null,{default:n(()=>[e(r(de))]),_:1}),o[13]||(o[13]=t("span",null,"订单管理",-1))]),_:1}),e(i,{index:"/admin/operation-log"},{default:n(()=>[e(l,null,{default:n(()=>[e(r(re))]),_:1}),o[14]||(o[14]=t("span",null,"日志查询",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(F,null,{default:n(()=>[e(q)]),_:1})]),_:1}),e(O,{modelValue:_.value,"onUpdate:modelValue":o[3]||(o[3]=m=>_.value=m),title:"修改密码",width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[t("span",pe,[e(b,{onClick:N},{default:n(()=>[...o[15]||(o[15]=[k("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:p},{default:n(()=>[...o[16]||(o[16]=[k("确定",-1)])]),_:1})])]),default:n(()=>[e(H,{model:a.value,"label-width":"100px"},{default:n(()=>[e(g,{label:"当前密码"},{default:n(()=>[e(w,{modelValue:a.value.currentPassword,"onUpdate:modelValue":o[0]||(o[0]=m=>a.value.currentPassword=m),type:"password",placeholder:"请输入当前密码","show-password":"",onKeyup:v(p,["enter"])},null,8,["modelValue"])]),_:1}),e(g,{label:"新密码"},{default:n(()=>[e(w,{modelValue:a.value.newPassword,"onUpdate:modelValue":o[1]||(o[1]=m=>a.value.newPassword=m),type:"password",placeholder:"请输入新密码（至少6位）","show-password":"",onKeyup:v(p,["enter"])},null,8,["modelValue"])]),_:1}),e(g,{label:"确认新密码"},{default:n(()=>[e(w,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=m=>a.value.confirmPassword=m),type:"password",placeholder:"请再次输入新密码","show-password":"",onKeyup:v(p,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}},ve=ue(ce,[["__scopeId","data-v-0042b462"]]);export{ve as default};
