import{h as I,i as E,r as o,o as m,c as h,b as r,w as l,z as _,m as k,E as d,a as f,F as R,A as j,f as v,t as q,B as U,d as y,j as A}from"./index-cf2541ee.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";const P={class:"order-container"},G={class:"order-content"},H={key:0,class:"selected-dates-info"},J={class:"total-price"},K={__name:"Order",setup(Q){const c=y(null),g=y(!1),a=y({orderDates:[],mealTypeId:""}),C={mealTypeId:[{required:!0,message:"请选择餐食类型",trigger:"change"}],orderDates:[{required:!0,message:"请选择至少一个订餐日期",trigger:"change"}]},b=y([]),p=I(()=>{if(!a.value.orderDates||a.value.orderDates.length===0)return[];const t=b.value.find(e=>e.id===a.value.mealTypeId);return t?a.value.orderDates.map(e=>({date:_(e).format("YYYY-MM-DD"),mealType:t.name,price:t.price})):[]}),V=I(()=>p.value.length===0?0:p.value.reduce((t,e)=>t+e.price,0)),x=t=>{const s=_().startOf("day").add(1,"day");return _(t).isBefore(s)},M=()=>{a.value={orderDates:[],mealTypeId:""},c.value&&c.value.resetFields()},Y=async()=>{var t,e;if(c.value){try{await c.value.validate()}catch{return}if(!a.value.orderDates||a.value.orderDates.length===0){d.error("请选择至少一个订餐日期");return}if(!a.value.mealTypeId){d.error("请选择餐食类型");return}g.value=!0;try{const s=a.value.orderDates.map(i=>_(i).format("YYYY-MM-DD")),n=await k.post("/api/order/batch-create",{mealTypeId:a.value.mealTypeId,orderDates:s});if(n.success){const i=n.successCount||0;(n.failCount||0)===0?d.success(n.message||"订餐成功"):i===0?d.error(n.message||"订餐失败"):d.warning(n.message||"部分订餐成功"),a.value={orderDates:[],mealTypeId:""},c.value&&c.value.resetFields()}else d.error(n.message||"订餐失败")}catch(s){console.error("创建订单请求错误:",s),d.error(((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.message)||"创建订单失败，请检查网络连接")}finally{g.value=!1}}},F=async()=>{try{const t=await k.get("/api/order/meal-types");t.success?b.value=t.data:d.error("加载餐食类型失败: "+(t.message||"未知错误"))}catch(t){console.error("加载餐食类型错误:",t),d.error("加载餐食类型失败: "+(t.message||"网络错误"))}};return E(()=>{F()}),(t,e)=>{const s=o("el-option"),n=o("el-select"),i=o("el-form-item"),T=o("el-date-picker"),w=o("el-button"),B=o("el-form"),S=o("el-divider"),D=o("el-table-column"),N=o("el-table"),O=o("el-tag"),z=o("el-card");return m(),h("div",P,[r(z,null,{header:l(()=>[...e[2]||(e[2]=[f("div",{class:"card-header"},[f("span",null,"在线订餐")],-1)])]),default:l(()=>[f("div",G,[r(B,{model:a.value,rules:C,ref_key:"orderFormRef",ref:c,"label-width":"100px"},{default:l(()=>[r(i,{label:"餐食类型",prop:"mealTypeId"},{default:l(()=>[r(n,{modelValue:a.value.mealTypeId,"onUpdate:modelValue":e[0]||(e[0]=u=>a.value.mealTypeId=u),placeholder:"选择餐食类型",style:{width:"100%"}},{default:l(()=>[(m(!0),h(R,null,j(b.value,u=>(m(),A(s,{key:u.id,label:u.name+" - ¥"+u.price,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"订餐日期",prop:"orderDates"},{default:l(()=>[r(T,{modelValue:a.value.orderDates,"onUpdate:modelValue":e[1]||(e[1]=u=>a.value.orderDates=u),type:"dates",placeholder:"选择多个订餐日期","disabled-date":x,style:{width:"100%"},multiple:"",clearable:""},null,8,["modelValue"])]),_:1}),r(i,null,{default:l(()=>[r(w,{type:"primary",onClick:Y,loading:g.value},{default:l(()=>[...e[3]||(e[3]=[v("提交订单",-1)])]),_:1},8,["loading"]),r(w,{onClick:M},{default:l(()=>[...e[4]||(e[4]=[v("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),p.value.length>0?(m(),h("div",H,[r(S,{"content-position":"left"},{default:l(()=>[...e[5]||(e[5]=[v("已选择的日期",-1)])]),_:1}),r(N,{data:p.value,style:{width:"100%"},size:"small"},{default:l(()=>[r(D,{prop:"date",label:"日期",width:"180"}),r(D,{prop:"mealType",label:"餐食类型"}),r(D,{prop:"price",label:"价格",width:"100"})]),_:1},8,["data"]),f("div",J,[r(O,{type:"success",size:"large"},{default:l(()=>[v("总计：¥"+q(V.value),1)]),_:1})])])):U("",!0)])]),_:1})])}}},Z=L(K,[["__scopeId","data-v-913aab72"]]);export{Z as default};
