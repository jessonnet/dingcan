import{i as te,r as n,M as ae,o as N,c as E,b as t,w as l,d as V,m as D,E as p,a as b,k as x,f as c,t as C,N as le,j as B,F as oe,A as se,e as z,n as re,O as ne,P as de,Q as ue,R as ie,S as pe}from"./index-cf2541ee.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";const me={class:"order-manage"},fe={class:"card-header"},_e={class:"total-info"},ge={class:"pagination-container"},be={class:"dialog-footer"},ve={__name:"OrderManage",setup(ye){const S=V(!1),d=z({status:null,userName:""}),u=V([]),_=z({sortField:"createdAt",sortOrder:"desc"}),r=z({page:1,pageSize:10,total:0}),T=V([]),M=V([]),h=V(!1),s=z({id:null,userId:null,username:"",realName:"",mealTypeId:null,orderDate:"",status:1}),g=async()=>{S.value=!0;try{const a={page:r.page,pageSize:r.pageSize,status:d.status,userName:d.userName,sortField:_.sortField,sortOrder:_.sortOrder};u.value&&u.value.length===2&&(a.startDate=u.value[0],a.endDate=u.value[1]);const e=await D.get("/api/admin/order/list",{params:a});e&&e.success?(T.value=e.data,r.total=e.total):p.error((e==null?void 0:e.message)||"获取订单列表失败")}catch(a){console.error("获取订单列表失败:",a),p.error("获取订单列表失败")}finally{S.value=!1}},Y=async()=>{try{const a=await D.get("/api/admin/meal-type/list");a&&a.success&&(M.value=a.data)}catch(a){console.error("获取餐食类型列表失败:",a)}},L=()=>{r.page=1,g()},A=()=>{d.status=null,d.userName="",u.value=[],_.sortField="createdAt",_.sortOrder="desc",r.page=1,g()},P=({prop:a,order:e})=>{a?(_.sortField=a,_.sortOrder=e==="ascending"?"asc":"desc"):(_.sortField="createdAt",_.sortOrder="desc"),g()},$=a=>{r.pageSize=a,r.page=1,g()},R=a=>{r.page=a,g()},j=async()=>{try{const a={status:d.status,userName:d.userName};u.value&&u.value.length===2&&(a.startDate=u.value[0],a.endDate=u.value[1]);const e=await D.get("/api/admin/order/export",{params:a,responseType:"blob"}),v=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=document.createElement("a");m.href=URL.createObjectURL(v),m.download=`订单数据_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(m),m.click(),document.body.removeChild(m),p.success("导出成功")}catch(a){console.error("导出失败:",a),p.error("导出失败")}},Q=a=>{s.id=a.id,s.userId=a.userId,s.username=a.username,s.realName=a.realName,s.mealTypeId=a.mealTypeId,s.orderDate=a.orderDate,s.status=a.status,h.value=!0},q=async()=>{try{const a=await D.put("/api/admin/order/update",s);a&&a.success?(p.success("修改成功"),h.value=!1,g()):p.error((a==null?void 0:a.message)||"修改失败")}catch(a){console.error("修改订单失败:",a),p.error("修改失败")}},G=a=>{re.confirm(`确定要删除订单 ${a.id} 吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await D.delete(`/api/admin/order/delete/${a.id}`);e&&e.success?(p.success("删除成功"),g()):p.error((e==null?void 0:e.message)||"删除失败")}catch(e){console.error("删除订单失败:",e),p.error("删除失败")}}).catch(()=>{})},H=a=>a||"",J=a=>a||"";return te(()=>{g(),Y()}),(a,e)=>{const v=n("el-option"),m=n("el-select"),f=n("el-form-item"),O=n("el-input"),U=n("el-date-picker"),w=n("el-icon"),y=n("el-button"),F=n("el-form"),I=n("el-card"),i=n("el-table-column"),K=n("el-tag"),W=n("el-table"),X=n("el-pagination"),Z=n("el-dialog"),ee=ae("loading");return N(),E("div",me,[t(I,{class:"filter-card"},{header:l(()=>[...e[11]||(e[11]=[b("div",{class:"card-header"},[b("span",null,"订单筛选")],-1)])]),default:l(()=>[t(F,{model:d,inline:""},{default:l(()=>[t(f,{label:"订单状态"},{default:l(()=>[t(m,{modelValue:d.status,"onUpdate:modelValue":e[0]||(e[0]=o=>d.status=o),placeholder:"全部状态",clearable:"",style:{width:"120px"}},{default:l(()=>[t(v,{label:"有效",value:1}),t(v,{label:"无效",value:0})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"用户姓名"},{default:l(()=>[t(O,{modelValue:d.userName,"onUpdate:modelValue":e[1]||(e[1]=o=>d.userName=o),placeholder:"输入用户姓名",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),t(f,{label:"日期范围"},{default:l(()=>[t(U,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=o=>u.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),t(f,null,{default:l(()=>[t(y,{type:"primary",onClick:L},{default:l(()=>[t(w,null,{default:l(()=>[t(x(ne))]),_:1}),e[12]||(e[12]=c(" 查询 ",-1))]),_:1}),t(y,{onClick:A},{default:l(()=>[t(w,null,{default:l(()=>[t(x(de))]),_:1}),e[13]||(e[13]=c(" 重置 ",-1))]),_:1}),t(y,{type:"success",onClick:j},{default:l(()=>[t(w,null,{default:l(()=>[t(x(ue))]),_:1}),e[14]||(e[14]=c(" 导出Excel ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(I,{class:"table-card"},{header:l(()=>[b("div",fe,[e[15]||(e[15]=b("span",null,"订单列表",-1)),b("span",_e,"共 "+C(r.total)+" 条记录",1)])]),default:l(()=>[le((N(),B(W,{data:T.value,stripe:"",border:"",style:{width:"100%"},onSortChange:P},{default:l(()=>[t(i,{prop:"id",label:"订单编号",width:"100",sortable:"custom"}),t(i,{prop:"username",label:"用户名",width:"120"}),t(i,{prop:"realName",label:"真实姓名",width:"120"}),t(i,{prop:"departmentName",label:"部门",width:"150"}),t(i,{prop:"mealTypeName",label:"餐食类型",width:"120"}),t(i,{prop:"mealPrice",label:"价格",width:"100",sortable:"custom"},{default:l(o=>{var k;return[b("span",null,"¥"+C(((k=o.row.mealPrice)==null?void 0:k.toFixed(2))||"0.00"),1)]}),_:1}),t(i,{prop:"orderDate",label:"订单日期",width:"120",sortable:"custom"},{default:l(o=>[c(C(H(o.row.orderDate)),1)]),_:1}),t(i,{prop:"statusDesc",label:"状态",width:"100"},{default:l(o=>[t(K,{type:o.row.status===1?"success":"danger"},{default:l(()=>[c(C(o.row.statusDesc),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"createdAt",label:"创建时间",width:"180",sortable:"custom"},{default:l(o=>[c(C(J(o.row.createdAt)),1)]),_:1}),t(i,{label:"操作",width:"150",fixed:"right"},{default:l(o=>[t(y,{type:"primary",size:"small",onClick:k=>Q(o.row)},{default:l(()=>[t(w,null,{default:l(()=>[t(x(ie))]),_:1}),e[16]||(e[16]=c(" 编辑 ",-1))]),_:1},8,["onClick"]),t(y,{type:"danger",size:"small",onClick:k=>G(o.row)},{default:l(()=>[t(w,null,{default:l(()=>[t(x(pe))]),_:1}),e[17]||(e[17]=c(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,S.value]]),b("div",ge,[t(X,{"current-page":r.page,"onUpdate:currentPage":e[3]||(e[3]=o=>r.page=o),"page-size":r.pageSize,"onUpdate:pageSize":e[4]||(e[4]=o=>r.pageSize=o),"page-sizes":[10,20,50,100],total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1}),t(Z,{modelValue:h.value,"onUpdate:modelValue":e[10]||(e[10]=o=>h.value=o),title:"编辑订单",width:"500px","close-on-click-modal":!1},{footer:l(()=>[b("span",be,[t(y,{onClick:e[9]||(e[9]=o=>h.value=!1)},{default:l(()=>[...e[18]||(e[18]=[c("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:q},{default:l(()=>[...e[19]||(e[19]=[c("确定",-1)])]),_:1})])]),default:l(()=>[t(F,{model:s,"label-width":"100px"},{default:l(()=>[t(f,{label:"订单编号"},{default:l(()=>[t(O,{modelValue:s.id,"onUpdate:modelValue":e[5]||(e[5]=o=>s.id=o),disabled:""},null,8,["modelValue"])]),_:1}),t(f,{label:"用户信息"},{default:l(()=>[t(O,{value:s.realName+" ("+s.username+")",disabled:""},null,8,["value"])]),_:1}),t(f,{label:"餐食类型"},{default:l(()=>[t(m,{modelValue:s.mealTypeId,"onUpdate:modelValue":e[6]||(e[6]=o=>s.mealTypeId=o),placeholder:"选择餐食类型",style:{width:"100%"}},{default:l(()=>[(N(!0),E(oe,null,se(M.value,o=>(N(),B(v,{key:o.id,label:o.name+" (¥"+o.price+")",value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"订单日期"},{default:l(()=>[t(U,{modelValue:s.orderDate,"onUpdate:modelValue":e[7]||(e[7]=o=>s.orderDate=o),type:"date",placeholder:"选择订单日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(f,{label:"订单状态"},{default:l(()=>[t(m,{modelValue:s.status,"onUpdate:modelValue":e[8]||(e[8]=o=>s.status=o),placeholder:"选择状态",style:{width:"100%"}},{default:l(()=>[t(v,{label:"有效",value:1}),t(v,{label:"无效",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ve=ce(ve,[["__scopeId","data-v-7507557f"]]);export{Ve as default};
