import{u as $,a as z,C as A,o as G,r as s,c as H,q as Q,w as a,f as e,e as t,k as r,t as W,j as C,Z as v,h as P,E as u,b as k,_ as X,v as Y,x as ee,s as S,y as oe,$ as ae,O as ne,a0 as le,a1 as se,a2 as te,N as de,a3 as re}from"./index-c314a4a7.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";const ie={class:"header-right"},me={class:"username-dropdown"},ce={class:"username"},_e={class:"dialog-footer"},fe={__name:"Layout",setup(pe){const f=$(),L=z();let p={};try{p=JSON.parse(localStorage.getItem("user")||"{}")}catch{p={}}const B=P(p),D=A(()=>L.path),E=d=>{f.push(d)},I=d=>{d==="changePassword"?N():d==="logout"&&x()},M=d=>{d?document.addEventListener("click",y):document.removeEventListener("click",y)},y=d=>{const o=document.querySelector(".el-dropdown");o&&!o.contains(d.target)&&o.classList.remove("is-active")},c=P(!1),n=P({currentPassword:"",newPassword:"",confirmPassword:""}),N=()=>{n.value={currentPassword:"",newPassword:"",confirmPassword:""},c.value=!0},K=()=>{c.value=!1,n.value={currentPassword:"",newPassword:"",confirmPassword:""}},_=async()=>{var d,o;if(!n.value.currentPassword){u.warning("请输入当前密码");return}if(!n.value.newPassword){u.warning("请输入新密码");return}if(n.value.newPassword.length<6){u.warning("新密码长度不能少于6位");return}if(n.value.newPassword!==n.value.confirmPassword){u.warning("两次输入的新密码不一致");return}try{const l=await k.post("/api/auth/change-password",{currentPassword:n.value.currentPassword,newPassword:n.value.newPassword});l.data.success?(u.success("密码修改成功，请重新登录"),c.value=!1,n.value={currentPassword:"",newPassword:"",confirmPassword:""},x()):u.error(l.data.message||"密码修改失败")}catch(l){u.error(((o=(d=l.response)==null?void 0:d.data)==null?void 0:o.message)||"密码修改失败，请稍后重试")}},x=async()=>{try{await X.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k.post("/api/auth/logout"),localStorage.removeItem("token"),localStorage.removeItem("user"),f.push("/login"),u.success("登出成功")}catch(d){d!=="cancel"&&u.error("登出失败")}};return G(()=>{localStorage.getItem("token")||f.push("/login")}),(d,o)=>{const l=s("el-icon"),h=s("el-dropdown-item"),U=s("el-dropdown-menu"),T=s("el-dropdown"),q=s("el-header"),i=s("el-menu-item"),O=s("el-menu"),R=s("el-aside"),j=s("router-view"),F=s("el-main"),V=s("el-container"),w=s("el-input"),g=s("el-form-item"),J=s("el-form"),b=s("el-button"),Z=s("el-dialog");return H(),Q(V,null,{default:a(()=>[e(q,null,{default:a(()=>[o[6]||(o[6]=t("div",{class:"header-left"},[t("h1",null,"单位内部饭堂订餐系统")],-1)),t("div",ie,[e(T,{trigger:"click",onCommand:I,onVisibleChange:M},{dropdown:a(()=>[e(U,null,{default:a(()=>[e(h,{command:"changePassword"},{default:a(()=>[e(l,null,{default:a(()=>[e(r(Y))]),_:1}),o[4]||(o[4]=t("span",null,"修改密码",-1))]),_:1}),e(h,{command:"logout",divided:""},{default:a(()=>[e(l,null,{default:a(()=>[e(r(ee))]),_:1}),o[5]||(o[5]=t("span",null,"退出登录",-1))]),_:1})]),_:1})]),default:a(()=>[t("span",me,[e(l,{class:"user-icon"},{default:a(()=>[e(r(S))]),_:1}),t("span",ce,W(B.value.name),1),e(l,{class:"arrow-icon"},{default:a(()=>[e(r(oe))]),_:1})])]),_:1})])]),_:1}),e(V,null,{default:a(()=>[e(R,{width:"200px"},{default:a(()=>[e(O,{"default-active":D.value,class:"el-menu-vertical-demo",onSelect:E},{default:a(()=>[e(i,{index:"/admin/system-config"},{default:a(()=>[e(l,null,{default:a(()=>[e(r(ae))]),_:1}),o[7]||(o[7]=t("span",null,"系统配置",-1))]),_:1}),e(i,{index:"/admin/meal-type"},{default:a(()=>[e(l,null,{default:a(()=>[e(r(ne))]),_:1}),o[8]||(o[8]=t("span",null,"餐食类型管理",-1))]),_:1}),e(i,{index:"/admin/employee"},{default:a(()=>[e(l,null,{default:a(()=>[e(r(S))]),_:1}),o[9]||(o[9]=t("span",null,"员工管理",-1))]),_:1}),e(i,{index:"/admin/department"},{default:a(()=>[e(l,null,{default:a(()=>[e(r(le))]),_:1}),o[10]||(o[10]=t("span",null,"部门设置",-1))]),_:1}),e(i,{index:"/admin/restaurant"},{default:a(()=>[e(l,null,{default:a(()=>[e(r(se))]),_:1}),o[11]||(o[11]=t("span",null,"餐厅管理",-1))]),_:1}),e(i,{index:"/admin/role"},{default:a(()=>[e(l,null,{default:a(()=>[e(r(te))]),_:1}),o[12]||(o[12]=t("span",null,"角色管理",-1))]),_:1}),e(i,{index:"/admin/order-manage"},{default:a(()=>[e(l,null,{default:a(()=>[e(r(de))]),_:1}),o[13]||(o[13]=t("span",null,"订单管理",-1))]),_:1}),e(i,{index:"/admin/operation-log"},{default:a(()=>[e(l,null,{default:a(()=>[e(r(re))]),_:1}),o[14]||(o[14]=t("span",null,"日志查询",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(F,null,{default:a(()=>[e(j)]),_:1})]),_:1}),e(Z,{modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=m=>c.value=m),title:"修改密码",width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[t("span",_e,[e(b,{onClick:K},{default:a(()=>[...o[15]||(o[15]=[C("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:_},{default:a(()=>[...o[16]||(o[16]=[C("确定",-1)])]),_:1})])]),default:a(()=>[e(J,{model:n.value,"label-width":"100px"},{default:a(()=>[e(g,{label:"当前密码"},{default:a(()=>[e(w,{modelValue:n.value.currentPassword,"onUpdate:modelValue":o[0]||(o[0]=m=>n.value.currentPassword=m),type:"password",placeholder:"请输入当前密码","show-password":"",onKeyup:v(_,["enter"])},null,8,["modelValue"])]),_:1}),e(g,{label:"新密码"},{default:a(()=>[e(w,{modelValue:n.value.newPassword,"onUpdate:modelValue":o[1]||(o[1]=m=>n.value.newPassword=m),type:"password",placeholder:"请输入新密码（至少6位）","show-password":"",onKeyup:v(_,["enter"])},null,8,["modelValue"])]),_:1}),e(g,{label:"确认新密码"},{default:a(()=>[e(w,{modelValue:n.value.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=m=>n.value.confirmPassword=m),type:"password",placeholder:"请再次输入新密码","show-password":"",onKeyup:v(_,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}},ve=ue(fe,[["__scopeId","data-v-ecfb0f5a"]]);export{ve as default};
