import{n as ct,p as ut,q as c,v as x,d as v,g as _t,x as vt,y as me,r as h,z as ft,o as i,c as M,a,b as l,w as o,A as z,h as S,B as Te,j,E as y,i as p,F as K,C as Q,t as f,f as V,D as pe,G as ge,H as mt,I as he,J as se,K as Ee,L as ye,M as pt,N as gt,O as ht,P as yt,l as Dt,Q as xe,R as wt,S as Mt,T as Le,U as Yt}from"./index-bda5bdc9.js";import{_ as kt}from"./_plugin-vue_export-helper-c27b6911.js";var Ot={exports:{}};(function(le,I){(function(X,b){le.exports=b(ct)})(ut,function(X){function b(m){return m&&typeof m=="object"&&"default"in m?m:{default:m}}var E=b(X),D={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(m,C){return C==="W"?m+"周":m+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(m,C){var u=100*m+C;return u<600?"凌晨":u<900?"早上":u<1100?"上午":u<1300?"中午":u<1800?"下午":"晚上"}};return E.default.locale(D,null,!0),D})})(Ot);class St{constructor(){this.history=[],this.maxHistorySize=10}saveState(I){this.history.push({timestamp:Date.now(),data:JSON.parse(JSON.stringify(I))}),this.history.length>this.maxHistorySize&&this.history.shift()}restoreState(){return this.history.length===0?null:this.history.pop().data}clearHistory(){this.history=[]}getHistorySize(){return this.history.length}peekLastState(){return this.history.length===0?null:this.history[this.history.length-1].data}}const bt={class:"order-manage-container"},It={class:"page-header"},Ct={class:"meal-type-list"},Tt=["onClick"],Et={class:"meal-type-info"},xt={class:"meal-type-name"},Lt={class:"meal-type-price"},Rt={class:"meal-type-status"},zt={class:"calendar-header"},Vt={class:"month-navigation"},At={class:"current-month"},Nt={class:"custom-calendar"},Ht={class:"calendar-weekdays"},Ut={class:"calendar-days"},Pt=["onClick"],Bt={class:"day-number"},Jt={key:0,class:"day-orders"},Wt={key:0,class:"more-orders"},$t={key:1,class:"day-status can-order-status"},Ft={key:2,class:"day-status"},jt={key:3,class:"day-status locked-status"},qt={class:"calendar-tip"},Gt={class:"list-header"},Kt={class:"date-cell"},Qt={class:"date-day"},Xt={class:"date-week"},Zt={class:"price"},ea={key:1,class:"cancelled-text"},ta={key:2,class:"locked-text"},aa={class:"pagination-wrapper"},sa={class:"confirm-order-content"},la={class:"confirm-icon success"},oa={class:"confirm-info"},na={class:"confirm-date"},ra={class:"confirm-meal"},da={class:"meal-price"},ia={class:"confirm-total"},ca={class:"total-price"},ua={class:"cancel-order-content"},_a={class:"confirm-icon warning"},va={class:"cancel-detail"},fa={class:"cancel-item"},ma={class:"label"},pa={class:"value"},ga={class:"cancel-item"},ha={class:"label"},ya={class:"value"},Da={class:"cancel-item"},wa={class:"label"},Ma={class:"value price"},Ya={class:"stat-content"},ka={class:"stat-icon bg-blue"},Oa={class:"stat-info"},Sa={class:"stat-value"},ba={class:"stat-content"},Ia={class:"stat-icon bg-green"},Ca={class:"stat-info"},Ta={class:"stat-value"},Ea={class:"stat-content"},xa={class:"stat-icon bg-orange"},La={class:"stat-info"},Ra={class:"stat-value"},za={class:"stat-content"},Va={class:"stat-icon bg-purple"},Aa={class:"stat-info"},Na={class:"stat-value"},Ha={__name:"OrderManage",setup(le){c.locale("zh-cn");const I=new St,X=x(()=>{const t=localStorage.getItem("user");if(t)try{return JSON.parse(t)}catch(e){return console.error("解析用户信息失败:",e),null}return null}),b={SELECTED_MEAL_TYPE:"canteen_selected_meal_type",TEMP_ORDER_DATA:"canteen_temp_order_data",VIEW_MODE:"canteen_view_mode"},E=v("calendar"),D=v(c()),m=v(""),C=v(null),u=v(null),B=v(!1),J=v(!1),oe=v(!1),ne=v(!1),re=v(!1),de=v(!1),Z=v(!1),q=v(!1),A=v(null),W=v([]),ie=v([]),Y=v([]),De=v([]),we=v(0),ce=v(1),ue=v(10),Me=c(),$=v([Me.startOf("month").toDate(),Me.endOf("month").toDate()]),Ye=v({restaurantId:""}),Re={restaurantId:[{required:!0,message:"请选择食堂",trigger:"change"}]},ze=v(null),ee=v(null),Ve=x(()=>W.value.find(t=>t.id===C.value)),F=x(()=>ie.value.find(t=>t.id===u.value)),Ae=x(()=>{const t=[],e=new Set;if(console.log("availableRestaurants computed - userRestaurantId:",ee.value),console.log("availableRestaurants computed - restaurants:",W.value),ee.value){const s=W.value.find(r=>r.id===ee.value);s&&(t.push({...s,isDefault:!0}),e.add(s.id))}return W.value.forEach(s=>{s.crossDepartmentBooking===1&&!e.has(s.id)&&(t.push({...s,isDefault:!1}),e.add(s.id))}),console.log("availableRestaurants computed - result:",t),t}),Ne=x(()=>D.value.format("YYYY年MM月")),He=["日","一","二","三","四","五","六"],Ue=x(()=>{const t=D.value.year(),e=D.value.month(),s=c().year(t).month(e).date(1),r=s.endOf("month"),_=s.startOf("week"),T=r.endOf("week"),k=[];let g=_;for(;g.isBefore(T)||g.isSame(T,"day");){const O=g.format("YYYY-MM-DD"),w=ke(O),L=u.value&&w.some(N=>N.mealTypeId===u.value);k.push({date:g,dateStr:O,dayOfMonth:g.date(),isCurrentMonth:g.month()===e,isToday:g.isSame(c(),"day"),hasOrder:w.length>0,hasCurrentMealTypeOrder:L,orders:w,canOrder:We(O),isLocked:$e(O)}),g=g.add(1,"day")}return k}),_e=x(()=>{const t=D.value.startOf("month"),e=D.value.endOf("month");return Y.value.filter(s=>{const r=c(s.orderDate);return r.isAfter(t)&&r.isBefore(e)})}),Pe=x(()=>_e.value.filter(t=>t.status===1).length),Be=x(()=>_e.value.filter(t=>t.status===1).reduce((t,e)=>t+(e.price||0),0).toFixed(2)),Je=x(()=>{const t=c().startOf("day");return Y.value.filter(e=>{const s=c(e.orderDate);return e.status===1&&(s.isAfter(t)||s.isSame(t,"day"))}).length}),ke=t=>Y.value.filter(e=>e.orderDate===t&&e.status===1),We=t=>{const e=c(t),r=c().startOf("day").add(1,"day");if(e.isBefore(r))return!1;if(e.isSame(r,"day")){const _=c(),T=c().hour(16).minute(0).second(0);if(_.isAfter(T))return!1}return!0},$e=t=>{const e=c(t),s=c().startOf("day");return e.isBefore(s)},Oe=t=>{const e=c(t),s=c().startOf("day");return e.isAfter(s)},Fe=async()=>{try{de.value=!0,console.log("loadRestaurants - start");const t=await j.get("/api/admin/restaurant/list");console.log("loadRestaurants - response:",t),t.success?(W.value=t.data,console.log("loadRestaurants - loaded restaurants:",W.value)):y.error("加载餐厅列表失败: "+(t.message||"未知错误"))}catch(t){console.error("加载餐厅列表错误:",t),y.error("加载餐厅列表失败: "+(t.message||"网络错误"))}finally{de.value=!1}},je=()=>{try{const t=localStorage.getItem("user");if(console.log("loadUserInfo - userStr:",t),t){const e=JSON.parse(t);console.log("loadUserInfo - parsed user:",e),e&&e.departmentId&&(ze.value=e.departmentId),e&&e.restaurantId&&(ee.value=e.restaurantId,C.value=e.restaurantId,Ye.value.restaurantId=e.restaurantId,console.log("loadUserInfo - set restaurantId:",e.restaurantId))}}catch(t){console.error("加载用户信息错误:",t)}},qe=t=>{if(!t.status){y.warning("该餐食类型当前暂停供应");return}u.value=t.id,localStorage.setItem(b.SELECTED_MEAL_TYPE,JSON.stringify({id:t.id,timestamp:Date.now()})),G(),y.success({message:`已选择: ${t.name}，日历状态已更新`,duration:2e3,showClose:!0})},Ge=t=>{var e;if(m.value=t.dateStr,G(),t.hasCurrentMealTypeOrder){const s=ke(t.dateStr);if(s.length>0){const r=s.find(_=>_.mealTypeId===u.value)||s[0];Oe(t.dateStr)?(A.value=r,q.value=!0):y.info({message:"该订单已过期，无法取消",duration:2e3})}}else if(t.canOrder){if(!u.value){y.warning({message:"请先选择餐食类型",duration:2e3,showClose:!0}),(e=document.querySelector(".meal-type-card"))==null||e.scrollIntoView({behavior:"smooth",block:"center"});return}Z.value=!0}},Ke=async()=>{var t,e,s,r,_,T;if(!C.value){y.warning({message:"请先选择食堂",duration:2e3});return}if(!u.value||!m.value){y.warning({message:"请选择餐食类型和日期",duration:2e3});return}B.value=!0;try{I.saveState(Y.value);const k={id:`temp_${Date.now()}`,userId:(t=X.value)==null?void 0:t.id,restaurantId:C.value,restaurantName:(e=Ve.value)==null?void 0:e.name,mealTypeId:u.value,mealTypeName:(s=F.value)==null?void 0:s.name,price:(r=F.value)==null?void 0:r.price,orderDate:m.value,status:1,createdAt:new Date().toISOString()};Y.value.push(k),Z.value=!1,y.success({message:"订餐成功！",duration:2e3,showClose:!0});const g=await j.post("/api/order/create",{restaurantId:C.value,mealTypeId:u.value,orderDate:m.value});if(g.success){const O=Y.value.findIndex(w=>w.id===k.id);O!==-1&&(Y.value[O].id=g.orderId||k.id),I.clearHistory(),tt()}else{const O=I.restoreState();O&&(Y.value=O),y.error({message:g.message||"订餐失败",duration:3e3,showClose:!0})}}catch(k){console.error("订餐失败:",k);const g=I.restoreState();g&&(Y.value=g),y.error({message:"订餐失败："+(((T=(_=k.response)==null?void 0:_.data)==null?void 0:T.message)||k.message||"网络错误"),duration:3e3,showClose:!0})}finally{B.value=!1}},Qe=t=>{A.value=t,q.value=!0},Xe=async()=>{var t,e;if(A.value){B.value=!0;try{I.saveState(Y.value);const s=A.value.id;Y.value=Y.value.filter(_=>_.id!==s),q.value=!1,y.success({message:"订单已取消",duration:2e3,showClose:!0});const r=await j.delete(`/api/order/delete/${s}`);if(r.success)A.value=null,I.clearHistory();else{const _=I.restoreState();_&&(Y.value=_),y.error({message:r.message||"取消失败",duration:3e3,showClose:!0})}}catch(s){console.error("取消订单失败:",s);const r=I.restoreState();r&&(Y.value=r),y.error({message:"取消失败："+(((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.message)||s.message||"网络错误"),duration:3e3,showClose:!0})}finally{B.value=!1}}},Se=t=>{D.value=D.value.add(t,"month"),G()},Ze=()=>{D.value=c(),m.value=c().format("YYYY-MM-DD"),G()},G=()=>{const t={currentDate:D.value.format("YYYY-MM-DD"),selectedDate:m.value,viewMode:E.value,timestamp:Date.now()};localStorage.setItem(b.TEMP_ORDER_DATA,JSON.stringify(t))},et=()=>{try{const t=localStorage.getItem(b.VIEW_MODE);t&&(E.value=t);const e=localStorage.getItem(b.SELECTED_MEAL_TYPE);if(e){const r=JSON.parse(e);Date.now()-r.timestamp<24*60*60*1e3?u.value=r.id:localStorage.removeItem(b.SELECTED_MEAL_TYPE)}const s=localStorage.getItem(b.TEMP_ORDER_DATA);if(s){const r=JSON.parse(s);Date.now()-r.timestamp<60*60*1e3?(r.currentDate&&(D.value=c(r.currentDate)),r.selectedDate&&(m.value=r.selectedDate),r.viewMode&&(E.value=r.viewMode)):localStorage.removeItem(b.TEMP_ORDER_DATA)}}catch(t){console.error("加载临时数据失败:",t)}},tt=()=>{localStorage.removeItem(b.TEMP_ORDER_DATA)},ve=t=>({早餐:"#e6a23c",午餐:"#67c23a",晚餐:"#409eff",夜宵:"#f56c6c"})[t]||"#909399",be=t=>t?c(t).format("YYYY年MM月DD日 dddd"):"",at=t=>c(t).format("MM-DD"),st=t=>["周日","周一","周二","周三","周四","周五","周六"][c(t).day()],lt=async()=>{var t,e;re.value=!0;try{const s=await j.get("/api/order/meal-types");((t=s.data)!=null&&t.success||s.success)&&(ie.value=((e=s.data)==null?void 0:e.data)||s.data||[])}catch(s){console.error("加载餐食类型失败:",s),y.error("加载餐食类型失败")}finally{re.value=!1}},Ie=async()=>{var t,e;oe.value=!0,J.value=!0;try{const s=D.value.year(),r=D.value.month(),_=c().year(s).month(r).date(1),T=_.endOf("month"),k=_.startOf("week"),g=T.endOf("week"),O=k.format("YYYY-MM-DD"),w=g.format("YYYY-MM-DD"),L=await j.get("/api/order/list",{params:{startDate:O,endDate:w}});((t=L.data)!=null&&t.success||L.success)&&(Y.value=((e=L.data)==null?void 0:e.data)||L.data||[])}catch(s){console.error("加载订单失败:",s),y.error("加载订单数据失败")}finally{oe.value=!1,J.value=!1}},te=async()=>{var t,e,s;ne.value=!0;try{const r={page:ce.value,pageSize:ue.value};$.value&&$.value.length===2&&(r.startDate=c($.value[0]).format("YYYY-MM-DD"),r.endDate=c($.value[1]).format("YYYY-MM-DD"));const _=await j.get("/api/order/page",{params:r});((t=_.data)!=null&&t.success||_.success)&&(De.value=((e=_.data)==null?void 0:e.data)||_.data||[],we.value=((s=_.data)==null?void 0:s.total)||_.total||0)}catch(r){console.error("加载订单列表失败:",r),y.error("加载订单列表失败")}finally{ne.value=!1}};return _t(()=>{if(et(),je(),Fe(),lt(),Ie(),te(),!m.value){const t=c();m.value=t.format("YYYY-MM-DD")}}),vt(()=>{I.clearHistory()}),me(D,()=>{Ie()}),me(u,()=>{}),me(E,t=>{localStorage.setItem(b.VIEW_MODE,t),G()}),(t,e)=>{const s=h("el-icon"),r=h("el-radio-button"),_=h("el-radio-group"),T=h("el-option"),k=h("el-select"),g=h("el-form-item"),O=h("el-form"),w=h("el-card"),L=h("el-tag"),N=h("el-button"),fe=h("el-alert"),ot=h("el-date-picker"),U=h("el-table-column"),nt=h("el-table"),rt=h("el-pagination"),dt=h("el-divider"),Ce=h("el-dialog"),ae=h("el-col"),it=h("el-row"),H=ft("loading");return i(),M("div",bt,[a("div",It,[e[11]||(e[11]=a("h2",{class:"page-title"},"在线订餐",-1)),l(_,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=n=>E.value=n),size:"small",class:"view-toggle"},{default:o(()=>[l(r,{label:"calendar"},{default:o(()=>[l(s,null,{default:o(()=>[l(p(ge))]),_:1}),e[9]||(e[9]=a("span",{class:"btn-text"},"日历视图",-1))]),_:1}),l(r,{label:"list"},{default:o(()=>[l(s,null,{default:o(()=>[l(p(mt))]),_:1}),e[10]||(e[10]=a("span",{class:"btn-text"},"列表视图",-1))]),_:1})]),_:1},8,["modelValue"])]),z((i(),S(w,{class:"meal-type-card restaurant-card",shadow:"never"},{default:o(()=>[l(O,{model:Ye.value,rules:Re,ref:"orderFormRef","label-width":"80px"},{default:o(()=>[l(g,{label:"食堂",prop:"restaurantId"},{default:o(()=>[l(k,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=n=>C.value=n),placeholder:"选择食堂",style:{width:"100%"},disabled:t.loadingRestaurants},{default:o(()=>[(i(!0),M(K,null,Q(Ae.value,n=>(i(),S(T,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),_:1})),[[H,de.value]]),z((i(),S(w,{class:"meal-type-card",shadow:"never"},{default:o(()=>[a("div",Ct,[(i(!0),M(K,null,Q(ie.value,n=>(i(),M("div",{key:n.id,class:he(["meal-type-item",{active:u.value===n.id,disabled:!n.status}]),onClick:d=>qe(n)},[a("div",{class:"meal-type-icon",style:pe({backgroundColor:ve(n.name)})},[l(s,null,{default:o(()=>[l(p(se))]),_:1})],4),a("div",Et,[a("div",xt,f(n.name),1),a("div",Lt,"¥"+f(n.price),1)]),a("div",Rt,[u.value===n.id?(i(),S(s,{key:0,class:"check-icon"},{default:o(()=>[l(p(Ee))]),_:1})):n.status?ye("",!0):(i(),S(L,{key:1,type:"info",size:"small",effect:"plain"},{default:o(()=>[...e[12]||(e[12]=[V("暂停",-1)])]),_:1}))])],10,Tt))),128))])]),_:1})),[[H,re.value]]),z((i(),S(w,{class:"calendar-card",shadow:"never"},{header:o(()=>[a("div",zt,[a("div",Vt,[l(N,{circle:"",size:"small",onClick:e[2]||(e[2]=n=>Se(-1))},{default:o(()=>[l(s,null,{default:o(()=>[l(p(pt))]),_:1})]),_:1}),a("span",At,f(Ne.value),1),l(N,{circle:"",size:"small",onClick:e[3]||(e[3]=n=>Se(1))},{default:o(()=>[l(s,null,{default:o(()=>[l(p(gt))]),_:1})]),_:1}),l(N,{size:"small",onClick:Ze,class:"today-btn",type:"primary",plain:""},{default:o(()=>[...e[13]||(e[13]=[V(" 今天 ",-1)])]),_:1})]),e[14]||(e[14]=a("div",{class:"legend"},[a("span",{class:"legend-item"},[a("span",{class:"legend-dot ordered"}),a("span",{class:"legend-text"},"已订餐")]),a("span",{class:"legend-item"},[a("span",{class:"legend-dot can-order"}),a("span",{class:"legend-text"},"可订餐")]),a("span",{class:"legend-item"},[a("span",{class:"legend-dot locked"}),a("span",{class:"legend-text"},"已过期")])],-1))])]),default:o(()=>{var n;return[a("div",Nt,[a("div",Ht,[(i(),M(K,null,Q(He,d=>a("div",{key:d,class:"weekday"},f(d),1)),64))]),a("div",Ut,[(i(!0),M(K,null,Q(Ue.value,(d,P)=>(i(),M("div",{key:P,class:he(["calendar-day",{"other-month":!d.isCurrentMonth,today:d.isToday,ordered:d.hasOrder,"can-order":d.canOrder&&u.value&&!d.hasOrder,locked:d.isLocked,selected:m.value===d.dateStr}]),onClick:R=>Ge(d)},[a("div",Bt,f(d.dayOfMonth),1),d.hasOrder?(i(),M("div",Jt,[(i(!0),M(K,null,Q(d.orders.slice(0,2),R=>(i(),M("div",{key:R.id,class:he(["order-badge",{"current-type":R.mealTypeId===u.value}]),style:pe({backgroundColor:R.mealTypeId===u.value?ve(R.mealTypeName):"#909399"})},f(R.mealTypeName),7))),128)),d.orders.length>2?(i(),M("span",Wt,"+"+f(d.orders.length-2),1)):ye("",!0)])):d.canOrder&&u.value?(i(),M("div",$t,[l(s,{class:"add-icon"},{default:o(()=>[l(p(ht))]),_:1}),e[15]||(e[15]=a("span",{class:"order-text"},"点击订餐",-1))])):d.canOrder&&!u.value?(i(),M("div",Ft,[l(s,{class:"select-icon"},{default:o(()=>[l(p(yt))]),_:1})])):d.isLocked?(i(),M("div",jt,[l(s,{class:"lock-icon"},{default:o(()=>[l(p(Dt))]),_:1}),e[16]||(e[16]=a("span",{class:"locked-text"},"已过期",-1))])):ye("",!0)],10,Pt))),128))])]),a("div",qt,[u.value?(i(),S(fe,{key:1,title:`当前选择: ${((n=F.value)==null?void 0:n.name)||"未知"} - 点击未订餐日期可创建订单，点击已订餐日期可取消订单`,type:"success",closable:!1,"show-icon":""},null,8,["title"])):(i(),S(fe,{key:0,title:"请先选择上方的餐食类型，然后点击日期进行订餐",type:"info",closable:!1,"show-icon":""}))])]}),_:1})),[[Te,E.value==="calendar"],[H,oe.value]]),z(l(w,{class:"list-card",shadow:"never"},{header:o(()=>[a("div",Gt,[e[17]||(e[17]=a("span",null,"订单列表",-1)),l(ot,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=n=>$.value=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small",onChange:te},null,8,["modelValue"])])]),default:o(()=>[z((i(),S(nt,{data:De.value,stripe:"",border:""},{default:o(()=>[l(U,{prop:"orderDate",label:"日期",width:"100"},{default:o(n=>[a("div",Kt,[a("div",Qt,f(at(n.row.orderDate)),1),a("div",Xt,f(st(n.row.orderDate)),1)])]),_:1}),l(U,{prop:"mealTypeName",label:"餐食类型",width:"100"},{default:o(n=>[a("div",{class:"meal-badge",style:pe({backgroundColor:ve(n.row.mealTypeName)})},f(n.row.mealTypeName),5)]),_:1}),l(U,{prop:"restaurantName",label:"食堂",width:"120"},{default:o(n=>[a("span",null,f(n.row.restaurantName||"-"),1)]),_:1}),l(U,{prop:"price",label:"价格",width:"80"},{default:o(n=>{var d;return[a("span",Zt,"¥"+f(((d=n.row.price)==null?void 0:d.toFixed(2))||"0.00"),1)]}),_:1}),l(U,{prop:"status",label:"状态",width:"80"},{default:o(n=>[l(L,{type:n.row.status===1?"success":"danger",size:"small",effect:"dark"},{default:o(()=>[V(f(n.row.status===1?"有效":"已取消"),1)]),_:2},1032,["type"])]),_:1}),l(U,{prop:"createdAt",label:"创建时间","min-width":"140"}),l(U,{label:"操作",width:"100",fixed:"right"},{default:o(n=>[n.row.status===1&&Oe(n.row.orderDate)?(i(),S(N,{key:0,type:"danger",size:"small",onClick:d=>Qe(n.row)},{default:o(()=>[...e[18]||(e[18]=[V(" 取消 ",-1)])]),_:1},8,["onClick"])):n.row.status!==1?(i(),M("span",ea,"已取消")):(i(),M("span",ta,"不可取消"))]),_:1})]),_:1},8,["data"])),[[H,ne.value]]),a("div",aa,[l(rt,{"current-page":ce.value,"onUpdate:currentPage":e[5]||(e[5]=n=>ce.value=n),"page-size":ue.value,"onUpdate:pageSize":e[6]||(e[6]=n=>ue.value=n),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",total:we.value,onSizeChange:te,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1},512),[[Te,E.value==="list"]]),l(Ce,{modelValue:Z.value,"onUpdate:modelValue":e[7]||(e[7]=n=>Z.value=n),title:"确认订餐",width:"340px","close-on-click-modal":!1,"destroy-on-close":"",class:"order-dialog"},{footer:o(()=>[l(N,{type:"primary",onClick:Ke,loading:B.value,size:"default",class:"full-width-btn"},{default:o(()=>[l(s,null,{default:o(()=>[l(p(xe))]),_:1}),e[20]||(e[20]=V(" 确认订餐 ",-1))]),_:1},8,["loading"])]),default:o(()=>{var n,d,P;return[a("div",sa,[a("div",la,[l(s,null,{default:o(()=>[l(p(Ee))]),_:1})]),a("div",oa,[a("div",na,[l(s,null,{default:o(()=>[l(p(ge))]),_:1}),a("span",null,f(be(m.value)),1)]),a("div",ra,[l(s,null,{default:o(()=>[l(p(se))]),_:1}),a("span",null,f((n=F.value)==null?void 0:n.name),1),a("span",da,"¥"+f((d=F.value)==null?void 0:d.price),1)])]),l(dt),a("div",ia,[e[19]||(e[19]=a("span",null,"订单金额:",-1)),a("span",ca,"¥"+f((P=F.value)==null?void 0:P.price),1)])])]}),_:1},8,["modelValue"]),l(Ce,{modelValue:q.value,"onUpdate:modelValue":e[8]||(e[8]=n=>q.value=n),title:"确认取消订单",width:"340px","close-on-click-modal":!1,"destroy-on-close":"",class:"order-dialog"},{footer:o(()=>[l(N,{type:"danger",onClick:Xe,loading:B.value,size:"default",class:"full-width-btn"},{default:o(()=>[l(s,null,{default:o(()=>[l(p(wt))]),_:1}),e[25]||(e[25]=V(" 取消订餐 ",-1))]),_:1},8,["loading"])]),default:o(()=>{var n,d,P,R;return[a("div",ua,[a("div",_a,[l(s,null,{default:o(()=>[l(p(Mt))]),_:1})]),e[24]||(e[24]=a("p",{class:"cancel-text"},"确定要取消以下订单吗？",-1)),a("div",va,[a("div",fa,[a("span",ma,[l(s,null,{default:o(()=>[l(p(ge))]),_:1}),e[21]||(e[21]=V(" 日期 ",-1))]),a("span",pa,f(be((n=A.value)==null?void 0:n.orderDate)),1)]),a("div",ga,[a("span",ha,[l(s,null,{default:o(()=>[l(p(se))]),_:1}),e[22]||(e[22]=V(" 餐食 ",-1))]),a("span",ya,f((d=A.value)==null?void 0:d.mealTypeName),1)]),a("div",Da,[a("span",wa,[l(s,null,{default:o(()=>[l(p(Le))]),_:1}),e[23]||(e[23]=V(" 金额 ",-1))]),a("span",Ma,"¥"+f((R=(P=A.value)==null?void 0:P.price)==null?void 0:R.toFixed(2)),1)])]),l(fe,{title:"取消后无法恢复，请谨慎操作",type:"warning",closable:!1,"show-icon":"",class:"cancel-warning"})])]}),_:1},8,["modelValue"]),l(it,{gutter:15,class:"stats-row"},{default:o(()=>[l(ae,{xs:12,sm:6},{default:o(()=>[z((i(),S(w,{class:"stat-card",shadow:"hover"},{default:o(()=>[a("div",Ya,[a("div",ka,[l(s,null,{default:o(()=>[l(p(se))]),_:1})]),a("div",Oa,[a("div",Sa,f(_e.value.length),1),e[26]||(e[26]=a("div",{class:"stat-label"},"本月订餐",-1))])])]),_:1})),[[H,J.value]])]),_:1}),l(ae,{xs:12,sm:6},{default:o(()=>[z((i(),S(w,{class:"stat-card",shadow:"hover"},{default:o(()=>[a("div",ba,[a("div",Ia,[l(s,null,{default:o(()=>[l(p(xe))]),_:1})]),a("div",Ca,[a("div",Ta,f(Pe.value),1),e[27]||(e[27]=a("div",{class:"stat-label"},"有效订单",-1))])])]),_:1})),[[H,J.value]])]),_:1}),l(ae,{xs:12,sm:6},{default:o(()=>[z((i(),S(w,{class:"stat-card",shadow:"hover"},{default:o(()=>[a("div",Ea,[a("div",xa,[l(s,null,{default:o(()=>[l(p(Le))]),_:1})]),a("div",La,[a("div",Ra,"¥"+f(Be.value),1),e[28]||(e[28]=a("div",{class:"stat-label"},"本月消费",-1))])])]),_:1})),[[H,J.value]])]),_:1}),l(ae,{xs:12,sm:6},{default:o(()=>[z((i(),S(w,{class:"stat-card",shadow:"hover"},{default:o(()=>[a("div",za,[a("div",Va,[l(s,null,{default:o(()=>[l(p(Yt))]),_:1})]),a("div",Aa,[a("div",Na,f(Je.value),1),e[29]||(e[29]=a("div",{class:"stat-label"},"待用餐",-1))])])]),_:1})),[[H,J.value]])]),_:1})]),_:1})])}}},Ba=kt(Ha,[["__scopeId","data-v-dba41b62"]]);export{Ba as default};
