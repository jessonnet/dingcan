import{d as _,z as D,i as C,r as p,o as w,c as k,b as s,w as a,m as E,E as v,a as r,f as n,t as i,F as V,A as j,j as B}from"./index-cf2541ee.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";const N={class:"statistics-container"},O={class:"card-header"},T={class:"date-range"},z={class:"statistics-content"},F={class:"total-count"},I={class:"meal-type-statistics"},A={class:"daily-statistics"},L={__name:"Statistics",setup(R){const c=_([D().subtract(7,"day").format("YYYY-MM-DD"),D().format("YYYY-MM-DD")]),g=_([]),h=_([]),y=_([]),m=_(0),x=async()=>{try{const o=await E.get("/api/chef/statistics",{params:{startDate:c.value[0],endDate:c.value[1]}});console.log("统计响应:",o),o.success?(y.value=o.mealTypes,m.value=o.totalCount,g.value=y.value.map(e=>{let u=0;for(const[f,l]of Object.entries(o.data))u+=l[e.id]||0;const d=m.value>0?Math.round(u/m.value*100):0;return{id:e.id,name:e.name,price:e.price,count:u,percentage:d}}),h.value=Object.entries(o.data).map(([e,u])=>{const d={date:e,count:0};for(const[f,l]of Object.entries(u))d["mealType_"+f]=l,d.count+=l;return d})):v.error(o.message||"加载统计数据失败")}catch(o){console.error("加载统计数据错误:",o),v.error("加载统计数据失败，请检查网络连接")}},M=async()=>{try{const o=`/api/chef/export?startDate=${c.value[0]}&endDate=${c.value[1]}`,e=document.createElement("a");e.href=o,e.download=`订餐统计_${c.value[0]}_${c.value[1]}.xlsx`,e.click(),v.success("导出成功")}catch(o){console.error("导出错误:",o),v.error("导出失败，请检查网络连接")}};return C(()=>{x()}),(o,e)=>{const u=p("el-date-picker"),d=p("el-button"),f=p("el-tag"),l=p("el-table-column"),Y=p("el-table"),b=p("el-card");return w(),k("div",N,[s(b,null,{header:a(()=>[r("div",O,[e[3]||(e[3]=r("span",null,"统计分析",-1)),r("div",T,[s(u,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"300px"}},null,8,["modelValue"]),s(d,{type:"primary",onClick:x,style:{"margin-left":"10px"}},{default:a(()=>[...e[1]||(e[1]=[n("查询",-1)])]),_:1}),s(d,{type:"success",onClick:M,style:{"margin-left":"10px"}},{default:a(()=>[...e[2]||(e[2]=[n("导出Excel",-1)])]),_:1})])])]),default:a(()=>[r("div",z,[r("div",F,[s(f,{size:"large",type:"info"},{default:a(()=>[n("总计："+i(m.value)+" 份",1)]),_:1})]),r("div",I,[s(b,null,{header:a(()=>[...e[4]||(e[4]=[r("span",null,"按餐食类型统计",-1)])]),default:a(()=>[s(Y,{data:g.value,style:{width:"100%"}},{default:a(()=>[s(l,{prop:"name",label:"餐食类型",width:"120"},{default:a(t=>[n(i(t.row.name),1)]),_:1}),s(l,{prop:"price",label:"价格",width:"100"},{default:a(t=>[n(" ¥"+i(t.row.price),1)]),_:1}),s(l,{prop:"count",label:"数量",width:"100"},{default:a(t=>[n(i(t.row.count),1)]),_:1}),s(l,{prop:"percentage",label:"占比"},{default:a(t=>[n(i(t.row.percentage)+"% ",1)]),_:1})]),_:1},8,["data"])]),_:1})]),r("div",A,[s(b,null,{header:a(()=>[...e[5]||(e[5]=[r("span",null,"按日期统计",-1)])]),default:a(()=>[s(Y,{data:h.value,style:{width:"100%"}},{default:a(()=>[s(l,{prop:"date",label:"日期",width:"120"},{default:a(t=>[n(i(t.row.date),1)]),_:1}),s(l,{prop:"count",label:"数量",width:"100"},{default:a(t=>[n(i(t.row.count),1)]),_:1}),(w(!0),k(V,null,j(y.value,t=>(w(),B(l,{key:t.id,prop:"mealType_"+t.id,label:t.name,width:"100"},{default:a(S=>[n(i(S.row["mealType_"+t.id]||0),1)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data"])]),_:1})])])]),_:1})])}}},G=$(L,[["__scopeId","data-v-6d0ea41b"]]);export{G as default};
