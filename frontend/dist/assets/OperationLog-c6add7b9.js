import{o as K,r,G as W,c as z,d as X,f as e,w as l,h as b,b as V,e as T,j as n,H as Z,q as ee,t as i,i as C}from"./index-c314a4a7.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";const le={class:"operation-log-container"},ae={class:"card-header"},oe={class:"header-actions"},ne={class:"filter-section"},re={class:"pagination-container"},se={__name:"OperationLog",setup(ie){const U=b([]),h=b(!1),E=b(!1),y=b(!1),d=b({}),p=b([]),c=C({userId:"",operationType:""}),w=C({beforeDate:""}),s=C({page:1,pageSize:10,total:0}),x=a=>({LOGIN:"登录",LOGOUT:"登出",CREATE:"创建",UPDATE:"更新",DELETE:"删除",QUERY:"查询"})[a]||a,O=a=>({LOGIN:"success",LOGOUT:"info",CREATE:"primary",UPDATE:"warning",DELETE:"danger",QUERY:""})[a]||"",Y=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",g=async()=>{h.value=!0;try{const a={page:s.page,pageSize:s.pageSize,...c};p.value&&p.value.length===2&&(a.startTime=p.value[0],a.endTime=p.value[1]);const t=await V.get("/api/admin/operation-log/list",{params:a});console.log("操作日志响应:",t),t&&t.success?(U.value=t.data,s.total=t.total):console.error("获取日志失败:",t)}catch(a){console.error("获取日志失败:",a)}finally{h.value=!1}},M=()=>{s.page=1,g()},A=()=>{c.userId="",c.operationType="",p.value=[],s.page=1,g()},S=a=>{s.pageSize=a,s.page=1,g()},R=a=>{s.page=a,g()},H=a=>{d.value=a,E.value=!0},G=async()=>{try{const a={...c};p.value&&p.value.length===2&&(a.startTime=p.value[0],a.endTime=p.value[1]);const t=await V.get("/api/admin/operation-log/export",{params:a,responseType:"blob"}),m=window.URL.createObjectURL(new Blob([t.data])),f=document.createElement("a");f.href=m,f.setAttribute("download",`操作日志_${new Date().getTime()}.xlsx`),document.body.appendChild(f),f.click(),document.body.removeChild(f)}catch(a){console.error("导出失败:",a)}},N=async()=>{if(!w.beforeDate){alert("请选择清理时间");return}try{const a=await V.delete("/api/admin/operation-log/clear",{params:{beforeDate:w.beforeDate}});a.data&&a.data.success&&(alert("清理成功"),y.value=!1,g())}catch(a){console.error("清理失败:",a),alert("清理失败")}};return K(()=>{g()}),(a,t)=>{const m=r("el-button"),f=r("el-input"),D=r("el-form-item"),v=r("el-option"),P=r("el-select"),I=r("el-date-picker"),L=r("el-form"),_=r("el-table-column"),B=r("el-tag"),$=r("el-table"),j=r("el-pagination"),q=r("el-card"),u=r("el-descriptions-item"),Q=r("el-descriptions"),k=r("el-dialog"),F=r("el-alert"),J=W("loading");return z(),X("div",le,[e(q,null,{header:l(()=>[T("div",ae,[t[12]||(t[12]=T("span",null,"操作日志",-1)),T("div",oe,[e(m,{type:"primary",onClick:G},{default:l(()=>[...t[10]||(t[10]=[n("导出日志",-1)])]),_:1}),e(m,{type:"danger",onClick:t[0]||(t[0]=o=>y.value=!0)},{default:l(()=>[...t[11]||(t[11]=[n("清理日志",-1)])]),_:1})])])]),default:l(()=>[T("div",ne,[e(L,{inline:!0,model:c,class:"filter-form"},{default:l(()=>[e(D,{label:"用户ID"},{default:l(()=>[e(f,{modelValue:c.userId,"onUpdate:modelValue":t[1]||(t[1]=o=>c.userId=o),placeholder:"输入用户ID",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(D,{label:"操作类型"},{default:l(()=>[e(P,{modelValue:c.operationType,"onUpdate:modelValue":t[2]||(t[2]=o=>c.operationType=o),placeholder:"选择操作类型",clearable:"",style:{width:"150px"}},{default:l(()=>[e(v,{label:"登录",value:"LOGIN"}),e(v,{label:"登出",value:"LOGOUT"}),e(v,{label:"创建",value:"CREATE"}),e(v,{label:"更新",value:"UPDATE"}),e(v,{label:"删除",value:"DELETE"}),e(v,{label:"查询",value:"QUERY"})]),_:1},8,["modelValue"])]),_:1}),e(D,{label:"时间范围"},{default:l(()=>[e(I,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=o=>p.value=o),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),e(D,null,{default:l(()=>[e(m,{type:"primary",onClick:M},{default:l(()=>[...t[13]||(t[13]=[n("搜索",-1)])]),_:1}),e(m,{onClick:A},{default:l(()=>[...t[14]||(t[14]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),Z((z(),ee($,{data:U.value,style:{width:"100%"}},{default:l(()=>[e(_,{prop:"id",label:"ID",width:"80"}),e(_,{prop:"userId",label:"用户ID",width:"100"}),e(_,{prop:"operationType",label:"操作类型",width:"100"},{default:l(o=>[e(B,{type:O(o.row.operationType)},{default:l(()=>[n(i(x(o.row.operationType)),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"module",label:"操作模块",width:"120","show-overflow-tooltip":""}),e(_,{prop:"description",label:"操作内容",width:"200","show-overflow-tooltip":""}),e(_,{prop:"ipAddress",label:"IP地址",width:"130"}),e(_,{prop:"createdAt",label:"操作时间",width:"180"},{default:l(o=>[n(i(Y(o.row.createdAt)),1)]),_:1}),e(_,{label:"操作",width:"100",fixed:"right"},{default:l(o=>[e(m,{type:"primary",size:"small",onClick:de=>H(o.row)},{default:l(()=>[...t[15]||(t[15]=[n("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,h.value]]),T("div",re,[e(j,{"current-page":s.page,"onUpdate:currentPage":t[4]||(t[4]=o=>s.page=o),"page-size":s.pageSize,"onUpdate:pageSize":t[5]||(t[5]=o=>s.pageSize=o),"page-sizes":[10,20,50,100],total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:S,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1}),e(k,{modelValue:E.value,"onUpdate:modelValue":t[6]||(t[6]=o=>E.value=o),title:"日志详情",width:"800px"},{default:l(()=>[e(Q,{column:2,border:""},{default:l(()=>[e(u,{label:"日志ID"},{default:l(()=>[n(i(d.value.id),1)]),_:1}),e(u,{label:"用户ID"},{default:l(()=>[n(i(d.value.userId),1)]),_:1}),e(u,{label:"用户名"},{default:l(()=>[n(i(d.value.username),1)]),_:1}),e(u,{label:"操作类型"},{default:l(()=>[n(i(x(d.value.operationType)),1)]),_:1}),e(u,{label:"操作模块"},{default:l(()=>[n(i(d.value.module),1)]),_:1}),e(u,{label:"操作内容"},{default:l(()=>[n(i(d.value.description),1)]),_:1}),e(u,{label:"IP地址"},{default:l(()=>[n(i(d.value.ipAddress),1)]),_:1}),e(u,{label:"请求方式"},{default:l(()=>[n(i(d.value.requestMethod),1)]),_:1}),e(u,{label:"请求URL"},{default:l(()=>[n(i(d.value.requestUrl),1)]),_:1}),e(u,{label:"操作时间",span:2},{default:l(()=>[n(i(Y(d.value.createdAt)),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(k,{modelValue:y.value,"onUpdate:modelValue":t[9]||(t[9]=o=>y.value=o),title:"清理日志",width:"500px"},{footer:l(()=>[e(m,{onClick:t[8]||(t[8]=o=>y.value=!1)},{default:l(()=>[...t[16]||(t[16]=[n("取消",-1)])]),_:1}),e(m,{type:"danger",onClick:N},{default:l(()=>[...t[17]||(t[17]=[n("确认清理",-1)])]),_:1})]),default:l(()=>[e(L,{model:w,"label-width":"100px"},{default:l(()=>[e(D,{label:"清理时间"},{default:l(()=>[e(I,{modelValue:w.beforeDate,"onUpdate:modelValue":t[7]||(t[7]=o=>w.beforeDate=o),type:"datetime",placeholder:"选择清理时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(F,{title:"警告",type:"warning",description:"此操作将永久删除指定时间之前的所有日志记录，请谨慎操作！",closable:!1,"show-icon":""})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ce=te(se,[["__scopeId","data-v-85b097c8"]]);export{ce as default};
