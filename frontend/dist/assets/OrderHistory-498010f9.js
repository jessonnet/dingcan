import{i as V,r as d,o as l,c as i,b as s,w as a,m as C,E as _,a as o,F as Y,A as F,B as O,d as v,t as u,j as x,f as w,z as h}from"./index-cf2541ee.js";import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";const P={class:"order-history-container"},U={class:"order-history-content"},$={key:0,class:"empty-state"},L={key:1,class:"aggregated-orders"},R={class:"order-date-header"},W={class:"date-info"},q={class:"date-text"},G={class:"date-weekday"},J={class:"meal-type-name"},K={class:"price-text"},Q={class:"created-time"},X={key:2,class:"pagination"},Z={__name:"OrderHistory",setup(ee){const m=v([]),y=v(1),g=v(10),b=v(0),z=t=>{const e=h(t),c=h().startOf("day");return c.add(1,"day"),!(e.isBefore(c)||e.isSame(c))},D=t=>h(t).format("YYYY年MM月DD日"),N=t=>["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][h(t).day()],T=({row:t,rowIndex:e})=>({早餐:"meal-type-breakfast",午餐:"meal-type-lunch",晚餐:"meal-type-dinner",夜宵:"meal-type-snack"})[t.mealTypeName]||"meal-type-default",f=async()=>{try{const t=await C.get("/api/order/aggregated-history",{params:{page:y.value,size:g.value}});t.success?(m.value=t.data,b.value=100):_.error("加载订单历史失败")}catch{_.error("加载订单历史失败，请检查网络连接")}},B=t=>{g.value=t,f()},S=t=>{y.value=t,f()},j=async t=>{try{const e=await C.delete(`/api/order/delete/${t}`);e.success?(_.success("取消订餐成功"),f()):_.error(e.message||"取消订餐失败")}catch{_.error("取消订餐失败，请检查网络连接")}};return V(()=>{f()}),(t,e)=>{const c=d("el-empty"),p=d("el-table-column"),k=d("el-tag"),A=d("el-button"),E=d("el-table"),H=d("el-pagination"),M=d("el-card");return l(),i("div",P,[s(M,null,{header:a(()=>[...e[2]||(e[2]=[o("div",{class:"card-header"},[o("span",null,"订单历史")],-1)])]),default:a(()=>[o("div",U,[m.value.length===0?(l(),i("div",$,[s(c,{description:"暂无订单记录"})])):(l(),i("div",L,[(l(!0),i(Y,null,F(m.value,r=>(l(),i("div",{key:r.orderDate,class:"aggregated-order-item"},[o("div",R,[o("div",W,[o("span",q,u(D(r.orderDate)),1),o("span",G,u(N(r.orderDate)),1)])]),s(E,{data:r.orders,style:{width:"100%"},size:"small","row-class-name":T,"cell-style":{padding:"6px 0"},"header-cell-style":{padding:"8px 0",backgroundColor:"#f5f7fa"}},{default:a(()=>[s(p,{prop:"mealTypeName",label:"餐食类型",width:"140"},{default:a(n=>[o("span",J,u(n.row.mealTypeName),1)]),_:1}),s(p,{prop:"price",label:"价格",width:"100"},{default:a(n=>[o("span",K,"¥"+u(n.row.price.toFixed(2)),1)]),_:1}),s(p,{prop:"statusText",label:"状态",width:"80"},{default:a(n=>[n.row.status===1?(l(),x(k,{key:0,type:"success",size:"small"},{default:a(()=>[...e[3]||(e[3]=[w("有效",-1)])]),_:1})):(l(),x(k,{key:1,type:"danger",size:"small"},{default:a(()=>[...e[4]||(e[4]=[w("无效",-1)])]),_:1}))]),_:1}),s(p,{prop:"createdAt",label:"创建时间",width:"160"},{default:a(n=>[o("span",Q,u(n.row.createdAt),1)]),_:1}),s(p,{label:"操作",width:"120"},{default:a(n=>[s(A,{type:"danger",size:"small",onClick:te=>j(n.row.id),disabled:!z(r.orderDate)},{default:a(()=>[...e[5]||(e[5]=[w(" 取消订餐 ",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["data"])]))),128))])),m.value.length>0?(l(),i("div",X,[s(H,{"current-page":y.value,"onUpdate:currentPage":e[0]||(e[0]=r=>y.value=r),"page-size":g.value,"onUpdate:pageSize":e[1]||(e[1]=r=>g.value=r),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:b.value,onSizeChange:B,onCurrentChange:S},null,8,["current-page","page-size","total"])])):O("",!0)])]),_:1})])}}},oe=I(Z,[["__scopeId","data-v-d6bfe540"]]);export{oe as default};
