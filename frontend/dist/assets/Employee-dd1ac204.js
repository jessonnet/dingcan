import{o as W,r as g,c as i,d as b,f as a,w as t,h as v,b as w,E as p,e as E,j as m,t as c,q as V,J as I,K as h,_ as X}from"./index-a918310c.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";const Z={class:"employee-container"},ee={class:"card-header"},le={class:"employee-content"},ae={class:"dialog-footer"},te={class:"dialog-footer"},re={__name:"Employee",setup(oe){const R=v([]),N=v([]),D=v([]),F=v([]),k=v(!1),q=v(null),o=v({username:"",password:"",name:"",departmentId:"",restaurantId:"",roleId:"",phone:"",email:"",status:1}),U=v(!1),B=v(null),s=v({id:"",username:"",password:"",name:"",departmentId:"",restaurantId:"",roleId:"",phone:"",email:"",status:1}),T={username:[{required:!0,message:"请输入用户名",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"change"}],name:[{required:!0,message:"请输入姓名",trigger:"change"}],departmentId:[{required:!1,message:"请选择部门",trigger:"change"}],restaurantId:[{required:!0,message:"请选择食堂",trigger:"change"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}],phone:[{required:!0,message:"请输入手机号",trigger:"change"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"change",required:!1}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},z={username:[{required:!0,message:"请输入用户名",trigger:"change"}],password:[{validator:(r,l,u)=>{l&&l.length<6?u(new Error("密码长度不能少于6位")):u()},trigger:"change"}],name:[{required:!0,message:"请输入姓名",trigger:"change"}],departmentId:[{required:!1,message:"请选择部门",trigger:"change"}],restaurantId:[{required:!0,message:"请选择食堂",trigger:"change"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}],phone:[{required:!0,message:"请输入手机号",trigger:"change"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"change",required:!1}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},x=async()=>{try{const r=await w.get("/api/admin/user/list");r.success?R.value=r.data:p.error("加载员工列表失败")}catch{p.error("加载员工列表失败，请检查网络连接")}},j=async()=>{try{const r=await w.get("/api/admin/role/list");r.success?N.value=r.data:p.error("加载角色列表失败")}catch{p.error("加载角色列表失败，请检查网络连接")}},A=async()=>{try{const r=await w.get("/api/admin/department/enabled");r.success?D.value=r.data:p.error("加载部门列表失败")}catch{p.error("加载部门列表失败，请检查网络连接")}},J=async()=>{try{const r=await w.get("/api/admin/restaurant/list");r.success?F.value=r.data:p.error("加载餐厅列表失败")}catch{p.error("加载餐厅列表失败，请检查网络连接")}},K=async()=>{q.value&&await q.value.validate(async r=>{if(r)try{const l={...o.value,status:o.value.status?1:0},u=await w.post("/api/admin/user/add",l);u.success?(p.success(u.message),k.value=!1,o.value={username:"",password:"",name:"",departmentId:"",restaurantId:"",roleId:"",phone:"",email:"",status:1},q.value.resetFields(),x()):p.error(u.message)}catch{p.error("添加失败，请检查网络连接")}})},L=r=>{s.value={id:r.id,username:r.username,password:"",name:r.name,departmentId:r.departmentId,restaurantId:r.restaurantId,roleId:r.roleId,phone:r.phone,email:r.email,status:r.status},U.value=!0},G=async()=>{B.value&&await B.value.validate(async r=>{if(r)try{const l={...s.value,status:s.value.status?1:0},u=await w.put("/api/admin/user/update",l);u.success?(p.success(u.message),U.value=!1,x()):p.error(u.message)}catch{p.error("编辑失败，请检查网络连接")}})},H=async r=>{var l,u;try{await X.confirm("确定要删除该员工吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const d=await w.delete(`/api/admin/user/delete/${r}`);d.success?(p.success(d.message),x()):p.error(d.message)}catch(d){if(d!=="cancel"){console.error("删除员工失败:",d);const C=d.message||((u=(l=d.response)==null?void 0:l.data)==null?void 0:u.message)||"删除失败，请检查网络连接";p.error(C)}}};return W(()=>{x(),j(),A(),J()}),(r,l)=>{const u=g("el-button"),d=g("el-table-column"),C=g("el-tag"),O=g("el-table"),P=g("el-card"),f=g("el-input"),n=g("el-form-item"),_=g("el-option"),y=g("el-select"),$=g("el-switch"),M=g("el-form"),S=g("el-dialog");return i(),b("div",Z,[a(P,null,{header:t(()=>[E("div",ee,[l[24]||(l[24]=E("span",null,"员工管理",-1)),a(u,{type:"primary",onClick:l[0]||(l[0]=e=>k.value=!0)},{default:t(()=>[...l[23]||(l[23]=[m("添加员工",-1)])]),_:1})])]),default:t(()=>[E("div",le,[a(O,{data:R.value,style:{width:"100%"}},{default:t(()=>[a(d,{prop:"id",label:"ID",width:"80"},{default:t(e=>[m(c(e.row.id),1)]),_:1}),a(d,{prop:"username",label:"用户名",width:"150"},{default:t(e=>[m(c(e.row.username),1)]),_:1}),a(d,{prop:"name",label:"姓名",width:"120"},{default:t(e=>[m(c(e.row.name),1)]),_:1}),a(d,{prop:"departmentName",label:"部门",width:"150"},{default:t(e=>[m(c(e.row.departmentName),1)]),_:1}),a(d,{prop:"restaurantName",label:"食堂",width:"150"},{default:t(e=>[m(c(e.row.restaurantName),1)]),_:1}),a(d,{prop:"roleName",label:"角色",width:"120"},{default:t(e=>[m(c(e.row.roleName),1)]),_:1}),a(d,{prop:"phone",label:"手机号",width:"150"},{default:t(e=>[m(c(e.row.phone),1)]),_:1}),a(d,{prop:"email",label:"邮箱",width:"200"},{default:t(e=>[m(c(e.row.email),1)]),_:1}),a(d,{prop:"balance",label:"余额",width:"100"},{default:t(e=>[m(c(e.row.balance||0),1)]),_:1}),a(d,{prop:"status",label:"状态",width:"100"},{default:t(e=>[e.row.status===1?(i(),V(C,{key:0,type:"success"},{default:t(()=>[...l[25]||(l[25]=[m("启用",-1)])]),_:1})):(i(),V(C,{key:1,type:"danger"},{default:t(()=>[...l[26]||(l[26]=[m("禁用",-1)])]),_:1}))]),_:1}),a(d,{label:"操作",width:"150"},{default:t(e=>[a(u,{type:"primary",size:"small",onClick:Q=>L(e.row)},{default:t(()=>[...l[27]||(l[27]=[m("编辑",-1)])]),_:1},8,["onClick"]),a(u,{type:"danger",size:"small",onClick:Q=>H(e.row.id)},{default:t(()=>[...l[28]||(l[28]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),a(S,{modelValue:k.value,"onUpdate:modelValue":l[11]||(l[11]=e=>k.value=e),title:"添加员工",width:"500px"},{footer:t(()=>[E("span",ae,[a(u,{onClick:l[10]||(l[10]=e=>k.value=!1)},{default:t(()=>[...l[29]||(l[29]=[m("取消",-1)])]),_:1}),a(u,{type:"primary",onClick:K},{default:t(()=>[...l[30]||(l[30]=[m("确定",-1)])]),_:1})])]),default:t(()=>[a(M,{model:o.value,rules:T,ref_key:"addEmployeeFormRef",ref:q,"label-width":"100px"},{default:t(()=>[a(n,{label:"用户名",prop:"username"},{default:t(()=>[a(f,{modelValue:o.value.username,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.username=e),placeholder:"输入用户名"},null,8,["modelValue"])]),_:1}),a(n,{label:"密码",prop:"password"},{default:t(()=>[a(f,{modelValue:o.value.password,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.password=e),type:"password",placeholder:"输入密码"},null,8,["modelValue"])]),_:1}),a(n,{label:"姓名",prop:"name"},{default:t(()=>[a(f,{modelValue:o.value.name,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.name=e),placeholder:"输入姓名"},null,8,["modelValue"])]),_:1}),a(n,{label:"部门",prop:"departmentId"},{default:t(()=>[a(y,{modelValue:o.value.departmentId,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.departmentId=e),placeholder:"选择部门",clearable:""},{default:t(()=>[(i(!0),b(I,null,h(D.value,e=>(i(),V(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"食堂",prop:"restaurantId"},{default:t(()=>[a(y,{modelValue:o.value.restaurantId,"onUpdate:modelValue":l[5]||(l[5]=e=>o.value.restaurantId=e),placeholder:"选择食堂",clearable:""},{default:t(()=>[(i(!0),b(I,null,h(F.value,e=>(i(),V(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"角色",prop:"roleId"},{default:t(()=>[a(y,{modelValue:o.value.roleId,"onUpdate:modelValue":l[6]||(l[6]=e=>o.value.roleId=e),placeholder:"选择角色"},{default:t(()=>[(i(!0),b(I,null,h(N.value,e=>(i(),V(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"手机号",prop:"phone"},{default:t(()=>[a(f,{modelValue:o.value.phone,"onUpdate:modelValue":l[7]||(l[7]=e=>o.value.phone=e),placeholder:"输入手机号"},null,8,["modelValue"])]),_:1}),a(n,{label:"邮箱",prop:"email"},{default:t(()=>[a(f,{modelValue:o.value.email,"onUpdate:modelValue":l[8]||(l[8]=e=>o.value.email=e),placeholder:"输入邮箱"},null,8,["modelValue"])]),_:1}),a(n,{label:"状态",prop:"status"},{default:t(()=>[a($,{modelValue:o.value.status,"onUpdate:modelValue":l[9]||(l[9]=e=>o.value.status=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(S,{modelValue:U.value,"onUpdate:modelValue":l[22]||(l[22]=e=>U.value=e),title:"编辑员工",width:"500px"},{footer:t(()=>[E("span",te,[a(u,{onClick:l[21]||(l[21]=e=>U.value=!1)},{default:t(()=>[...l[31]||(l[31]=[m("取消",-1)])]),_:1}),a(u,{type:"primary",onClick:G},{default:t(()=>[...l[32]||(l[32]=[m("确定",-1)])]),_:1})])]),default:t(()=>[a(M,{model:s.value,rules:z,ref_key:"editEmployeeFormRef",ref:B,"label-width":"100px"},{default:t(()=>[a(n,{label:"用户名",prop:"username"},{default:t(()=>[a(f,{modelValue:s.value.username,"onUpdate:modelValue":l[12]||(l[12]=e=>s.value.username=e),placeholder:"输入用户名"},null,8,["modelValue"])]),_:1}),a(n,{label:"密码",prop:"password"},{default:t(()=>[a(f,{modelValue:s.value.password,"onUpdate:modelValue":l[13]||(l[13]=e=>s.value.password=e),type:"password",placeholder:"输入密码（留空则不修改）"},null,8,["modelValue"])]),_:1}),a(n,{label:"姓名",prop:"name"},{default:t(()=>[a(f,{modelValue:s.value.name,"onUpdate:modelValue":l[14]||(l[14]=e=>s.value.name=e),placeholder:"输入姓名"},null,8,["modelValue"])]),_:1}),a(n,{label:"部门",prop:"departmentId"},{default:t(()=>[a(y,{modelValue:s.value.departmentId,"onUpdate:modelValue":l[15]||(l[15]=e=>s.value.departmentId=e),placeholder:"选择部门",clearable:""},{default:t(()=>[(i(!0),b(I,null,h(D.value,e=>(i(),V(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"食堂",prop:"restaurantId"},{default:t(()=>[a(y,{modelValue:s.value.restaurantId,"onUpdate:modelValue":l[16]||(l[16]=e=>s.value.restaurantId=e),placeholder:"选择食堂",clearable:""},{default:t(()=>[(i(!0),b(I,null,h(F.value,e=>(i(),V(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"角色",prop:"roleId"},{default:t(()=>[a(y,{modelValue:s.value.roleId,"onUpdate:modelValue":l[17]||(l[17]=e=>s.value.roleId=e),placeholder:"选择角色"},{default:t(()=>[(i(!0),b(I,null,h(N.value,e=>(i(),V(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"手机号",prop:"phone"},{default:t(()=>[a(f,{modelValue:s.value.phone,"onUpdate:modelValue":l[18]||(l[18]=e=>s.value.phone=e),placeholder:"输入手机号"},null,8,["modelValue"])]),_:1}),a(n,{label:"邮箱",prop:"email"},{default:t(()=>[a(f,{modelValue:s.value.email,"onUpdate:modelValue":l[19]||(l[19]=e=>s.value.email=e),placeholder:"输入邮箱"},null,8,["modelValue"])]),_:1}),a(n,{label:"状态",prop:"status"},{default:t(()=>[a($,{modelValue:s.value.status,"onUpdate:modelValue":l[20]||(l[20]=e=>s.value.status=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},de=Y(re,[["__scopeId","data-v-45c52d43"]]);export{de as default};
