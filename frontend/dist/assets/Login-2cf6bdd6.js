import{u as y,r as i,o as w,c as b,a as d,b as n,w as c,d as k,e as v,f as S,E as a}from"./index-cf2541ee.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";const x={class:"login-container"},T={class:"login-form"},I={__name:"Login",setup(N){const p=y(),g=k(null),t=v({username:"",password:""}),_={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},f=async()=>{if(console.log("开始登录流程"),!!g.value)try{console.log("开始表单验证"),g.value.validate(async(u,s)=>{if(u){console.log("表单验证成功"),console.log("开始发送登录请求"),console.log("登录表单数据:",t);try{console.log("准备使用fetch发送登录请求"),console.log("登录表单数据:",t);const e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)});if(console.log("fetch响应状态:",e.status),console.log("fetch响应头:",e.headers),!e.ok)throw console.error("HTTP错误:",e.status,e.statusText),new Error(`HTTP error! status: ${e.status}`);const o=await e.json();if(console.log("登录响应数据:",o),o&&o.success){console.log("响应成功，success为true");const r=o.user,m=o.token;console.log("响应user:",r),console.log("响应user.role:",r.role),r.role&&(r.role=r.role.toLowerCase()),localStorage.setItem("token",m),localStorage.setItem("user",JSON.stringify(r)),console.log("存储的token:",localStorage.getItem("token")),console.log("存储的user:",localStorage.getItem("user")),console.log("存储的user.role:",JSON.parse(localStorage.getItem("user")).role),console.log("开始路由跳转，角色:",r.role);let l="/login";switch(r.role?r.role:""){case"employee":l="/employee/order";break;case"chef":l="/chef/order-status";break;case"admin":l="/admin/system-config";break}console.log("准备跳转到:",l);try{p.push(l),console.log("路由跳转命令已执行")}catch(h){console.error("路由跳转错误:",h),a.error("页面跳转失败，请刷新页面重试")}a.success("登录成功")}else console.error("登录失败，success为false或响应格式错误"),console.error("响应数据:",o),a.error((o==null?void 0:o.message)||"登录失败")}catch(e){console.error("登录错误:",e),console.error("错误消息:",e.message),a.error("登录失败，请检查用户名和密码")}}else console.error("表单验证失败:",s),a.error("表单验证失败，请检查输入内容")})}catch(u){console.error("登录流程错误:",u),a.error("登录失败，请刷新页面重试")}};return(u,s)=>{const e=i("el-input"),o=i("el-form-item"),r=i("el-button"),m=i("el-form");return w(),b("div",x,[d("div",T,[s[3]||(s[3]=d("h2",null,"单位内部饭堂订餐系统",-1)),n(m,{model:t,rules:_,ref_key:"loginFormRef",ref:g,"label-width":"80px"},{default:c(()=>[n(o,{label:"用户名",prop:"username"},{default:c(()=>[n(e,{modelValue:t.username,"onUpdate:modelValue":s[0]||(s[0]=l=>t.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),n(o,{label:"密码",prop:"password"},{default:c(()=>[n(e,{modelValue:t.password,"onUpdate:modelValue":s[1]||(s[1]=l=>t.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),n(o,null,{default:c(()=>[n(r,{type:"primary",onClick:f,class:"login-button"},{default:c(()=>[...s[2]||(s[2]=[S("登录",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])}}},O=V(I,[["__scopeId","data-v-1444ce81"]]);export{O as default};
