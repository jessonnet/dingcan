import{u as T,g as j,r as l,o as F,h as J,w as s,b as e,a as u,i as _,t as y,f as b,d as w,E as c,j as O,k as V,l as R,s as $,m as q}from"./index-bda5bdc9.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";const A={class:"header-right"},G={class:"username-dropdown"},H={class:"username hidden-xs"},K={__name:"Layout",setup(Q){const k=T(),p=w({name:""}),x=()=>{try{const t=JSON.parse(localStorage.getItem("user")||"{}");p.value=t}catch(t){console.error("加载用户信息失败:",t)}},C=t=>{switch(t){case"changePassword":S();break;case"logout":P();break}},P=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),k.push("/login"),c.success("已退出登录")},i=w(!1),f=w(!1),a=w({currentPassword:"",newPassword:"",confirmPassword:""}),S=()=>{a.value={currentPassword:"",newPassword:"",confirmPassword:""},i.value=!0},I=async()=>{var t,o,r,m;if(!a.value.currentPassword){c.warning("请输入当前密码");return}if(!a.value.newPassword){c.warning("请输入新密码");return}if(a.value.newPassword.length<6){c.warning("新密码长度不能少于6位");return}if(a.value.newPassword!==a.value.confirmPassword){c.warning("两次输入的新密码不一致");return}f.value=!0;try{const n=await O.post("/api/auth/change-password",{currentPassword:a.value.currentPassword,newPassword:a.value.newPassword});(t=n.data)!=null&&t.success||n.success?(c.success("密码修改成功，请重新登录"),i.value=!1,setTimeout(()=>{P()},1500)):c.error(((o=n.data)==null?void 0:o.message)||n.message||"密码修改失败")}catch(n){console.error("修改密码失败:",n),c.error("修改密码失败："+(((m=(r=n.response)==null?void 0:r.data)==null?void 0:m.message)||n.message||"网络错误"))}finally{f.value=!1}};return j(()=>{x()}),(t,o)=>{const r=l("el-icon"),m=l("el-dropdown-item"),n=l("el-dropdown-menu"),U=l("el-dropdown"),D=l("el-header"),L=l("router-view"),N=l("el-main"),g=l("el-input"),v=l("el-form-item"),B=l("el-form"),h=l("el-button"),E=l("el-dialog"),M=l("el-container");return F(),J(M,{class:"employee-layout"},{default:s(()=>[e(D,{class:"mobile-header"},{default:s(()=>[o[7]||(o[7]=u("div",{class:"header-left"},[u("h1",{class:"system-title"},"食堂订餐")],-1)),u("div",A,[e(U,{trigger:"click",onCommand:C},{dropdown:s(()=>[e(n,null,{default:s(()=>[e(m,{command:"profile"},{default:s(()=>[e(r,null,{default:s(()=>[e(_(V))]),_:1}),u("span",null,y(p.value.name),1)]),_:1}),e(m,{command:"changePassword",divided:""},{default:s(()=>[e(r,null,{default:s(()=>[e(_(R))]),_:1}),o[5]||(o[5]=u("span",null,"修改密码",-1))]),_:1}),e(m,{command:"logout"},{default:s(()=>[e(r,null,{default:s(()=>[e(_($))]),_:1}),o[6]||(o[6]=u("span",null,"退出登录",-1))]),_:1})]),_:1})]),default:s(()=>[u("span",G,[e(r,{class:"user-icon"},{default:s(()=>[e(_(V))]),_:1}),u("span",H,y(p.value.name),1),e(r,{class:"arrow-icon"},{default:s(()=>[e(_(q))]),_:1})])]),_:1})])]),_:1}),e(N,{class:"main-content"},{default:s(()=>[e(L)]),_:1}),e(E,{modelValue:i.value,"onUpdate:modelValue":o[4]||(o[4]=d=>i.value=d),title:"修改密码",width:"360px","close-on-click-modal":!1,"destroy-on-close":""},{footer:s(()=>[e(h,{onClick:o[3]||(o[3]=d=>i.value=!1)},{default:s(()=>[...o[8]||(o[8]=[b("取消",-1)])]),_:1}),e(h,{type:"primary",onClick:I,loading:f.value},{default:s(()=>[...o[9]||(o[9]=[b(" 确认修改 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[e(B,{model:a.value,"label-width":"90px",class:"password-form"},{default:s(()=>[e(v,{label:"当前密码"},{default:s(()=>[e(g,{modelValue:a.value.currentPassword,"onUpdate:modelValue":o[0]||(o[0]=d=>a.value.currentPassword=d),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),e(v,{label:"新密码"},{default:s(()=>[e(g,{modelValue:a.value.newPassword,"onUpdate:modelValue":o[1]||(o[1]=d=>a.value.newPassword=d),type:"password",placeholder:"至少6位字符","show-password":""},null,8,["modelValue"])]),_:1}),e(v,{label:"确认密码"},{default:s(()=>[e(g,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=d=>a.value.confirmPassword=d),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}},Y=z(K,[["__scopeId","data-v-2fb3eff5"]]);export{Y as default};
