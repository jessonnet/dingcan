import{u as z,g as A,h as G,i as H,r as n,o as Q,j as W,w as a,b as e,a as r,k as c,t as X,f as k,l as v,d as g,E as d,m as C,n as Y,p as Z,s as $,q as ee,v as oe,x as ae,y as se}from"./index-cf2541ee.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";const le={class:"header-right"},te={class:"username-dropdown"},re={class:"username"},de={class:"dialog-footer"},ue={__name:"Layout",setup(ce){const _=z(),S=A();let p={};try{p=JSON.parse(localStorage.getItem("user")||"{}")}catch{p={}}const L=g(p),B=G(()=>S.path),D=l=>{_.push(l)},E=l=>{l==="changePassword"?M():l==="logout"&&h()},I=l=>{l?document.addEventListener("click",P):document.removeEventListener("click",P)},P=l=>{const o=document.querySelector(".el-dropdown");o&&!o.contains(l.target)&&o.classList.remove("is-active")},i=g(!1),s=g({currentPassword:"",newPassword:"",confirmPassword:""}),M=()=>{s.value={currentPassword:"",newPassword:"",confirmPassword:""},i.value=!0},K=()=>{i.value=!1,s.value={currentPassword:"",newPassword:"",confirmPassword:""}},m=async()=>{var l,o;if(!s.value.currentPassword){d.warning("请输入当前密码");return}if(!s.value.newPassword){d.warning("请输入新密码");return}if(s.value.newPassword.length<6){d.warning("新密码长度不能少于6位");return}if(s.value.newPassword!==s.value.confirmPassword){d.warning("两次输入的新密码不一致");return}try{const t=await C.post("/api/auth/change-password",{currentPassword:s.value.currentPassword,newPassword:s.value.newPassword});t.success?(d.success("密码修改成功，请重新登录"),i.value=!1,s.value={currentPassword:"",newPassword:"",confirmPassword:""},h()):d.error(t.message||"密码修改失败")}catch(t){d.error(((o=(l=t.response)==null?void 0:l.data)==null?void 0:o.message)||"密码修改失败，请稍后重试")}},h=async()=>{try{await Y.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.post("/api/auth/logout"),localStorage.removeItem("token"),localStorage.removeItem("user"),_.push("/login"),d.success("登出成功")}catch(l){l!=="cancel"&&d.error("登出失败")}};return H(()=>{localStorage.getItem("token")||_.push("/login")}),(l,o)=>{const t=n("el-icon"),y=n("el-dropdown-item"),N=n("el-dropdown-menu"),U=n("el-dropdown"),T=n("el-header"),V=n("el-menu-item"),q=n("el-menu"),R=n("el-aside"),j=n("router-view"),F=n("el-main"),x=n("el-container"),w=n("el-input"),f=n("el-form-item"),J=n("el-form"),b=n("el-button"),O=n("el-dialog");return Q(),W(x,null,{default:a(()=>[e(T,null,{default:a(()=>[o[6]||(o[6]=r("div",{class:"header-left"},[r("h1",null,"单位内部饭堂订餐系统")],-1)),r("div",le,[e(U,{trigger:"click",onCommand:E,onVisibleChange:I},{dropdown:a(()=>[e(N,null,{default:a(()=>[e(y,{command:"changePassword"},{default:a(()=>[e(t,null,{default:a(()=>[e(c(Z))]),_:1}),o[4]||(o[4]=r("span",null,"修改密码",-1))]),_:1}),e(y,{command:"logout",divided:""},{default:a(()=>[e(t,null,{default:a(()=>[e(c($))]),_:1}),o[5]||(o[5]=r("span",null,"退出登录",-1))]),_:1})]),_:1})]),default:a(()=>[r("span",te,[e(t,{class:"user-icon"},{default:a(()=>[e(c(ee))]),_:1}),r("span",re,X(L.value.name),1),e(t,{class:"arrow-icon"},{default:a(()=>[e(c(oe))]),_:1})])]),_:1})])]),_:1}),e(x,null,{default:a(()=>[e(R,{width:"200px"},{default:a(()=>[e(q,{"default-active":B.value,class:"el-menu-vertical-demo",onSelect:D},{default:a(()=>[e(V,{index:"/employee/order"},{default:a(()=>[e(t,null,{default:a(()=>[e(c(ae))]),_:1}),o[7]||(o[7]=r("span",null,"在线订餐",-1))]),_:1}),e(V,{index:"/employee/order-history"},{default:a(()=>[e(t,null,{default:a(()=>[e(c(se))]),_:1}),o[8]||(o[8]=r("span",null,"订单历史",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(F,null,{default:a(()=>[e(j)]),_:1})]),_:1}),e(O,{modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=u=>i.value=u),title:"修改密码",width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[r("span",de,[e(b,{onClick:K},{default:a(()=>[...o[9]||(o[9]=[k("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:m},{default:a(()=>[...o[10]||(o[10]=[k("确定",-1)])]),_:1})])]),default:a(()=>[e(J,{model:s.value,"label-width":"100px"},{default:a(()=>[e(f,{label:"当前密码"},{default:a(()=>[e(w,{modelValue:s.value.currentPassword,"onUpdate:modelValue":o[0]||(o[0]=u=>s.value.currentPassword=u),type:"password",placeholder:"请输入当前密码","show-password":"",onKeyup:v(m,["enter"])},null,8,["modelValue"])]),_:1}),e(f,{label:"新密码"},{default:a(()=>[e(w,{modelValue:s.value.newPassword,"onUpdate:modelValue":o[1]||(o[1]=u=>s.value.newPassword=u),type:"password",placeholder:"请输入新密码（至少6位）","show-password":"",onKeyup:v(m,["enter"])},null,8,["modelValue"])]),_:1}),e(f,{label:"确认新密码"},{default:a(()=>[e(w,{modelValue:s.value.confirmPassword,"onUpdate:modelValue":o[2]||(o[2]=u=>s.value.confirmPassword=u),type:"password",placeholder:"请再次输入新密码","show-password":"",onKeyup:v(m,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}},_e=ne(ue,[["__scopeId","data-v-df7ab10a"]]);export{_e as default};
