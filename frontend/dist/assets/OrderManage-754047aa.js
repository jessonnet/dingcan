import{z as _t,A as vt,B as u,C as x,h as _,o as mt,D as ft,F as pe,r as y,G as pt,c as i,d as S,e as a,f as l,w as o,H as z,q as O,I as Ee,b as B,E as D,k as g,J as K,K as Q,t as f,j as V,L as ge,M as ye,N as gt,n as he,O as se,P as xe,g as we,Q as yt,R as ht,S as wt,T as Dt,v as kt,U as Le,V as Mt,W as Yt,X as Re,Y as St}from"./index-a918310c.js";import{_ as bt}from"./_plugin-vue_export-helper-c27b6911.js";var Ot={exports:{}};(function(le,I){(function(X,T){le.exports=T(_t)})(vt,function(X){function T(p){return p&&typeof p=="object"&&"default"in p?p:{default:p}}var E=T(X),k={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(p,C){return C==="W"?p+"周":p+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(p,C){var v=100*p+C;return v<600?"凌晨":v<900?"早上":v<1100?"上午":v<1300?"中午":v<1800?"下午":"晚上"}};return E.default.locale(k,null,!0),k})})(Ot);class Tt{constructor(){this.history=[],this.maxHistorySize=10}saveState(I){this.history.push({timestamp:Date.now(),data:JSON.parse(JSON.stringify(I))}),this.history.length>this.maxHistorySize&&this.history.shift()}restoreState(){return this.history.length===0?null:this.history.pop().data}clearHistory(){this.history=[]}getHistorySize(){return this.history.length}peekLastState(){return this.history.length===0?null:this.history[this.history.length-1].data}}const It={class:"order-manage-container"},Ct={class:"page-header"},Et={class:"meal-type-list"},xt=["onClick"],Lt={class:"meal-type-info"},Rt={class:"meal-type-name"},zt={class:"meal-type-price"},Vt={class:"meal-type-status"},At={class:"calendar-header"},Nt={class:"month-navigation"},Ht={class:"current-month"},Ut={class:"custom-calendar"},Pt={class:"calendar-weekdays"},Bt={class:"calendar-days"},Wt=["onClick"],Jt={class:"day-number"},$t={key:0,class:"day-orders"},Ft={key:0,class:"more-orders"},jt={key:1,class:"day-status can-order-status"},qt={key:2,class:"day-status"},Gt={key:3,class:"day-status locked-status"},Kt={class:"calendar-tip"},Qt={class:"list-header"},Xt={class:"date-cell"},Zt={class:"date-day"},ea={class:"date-week"},ta={class:"price"},aa={key:1,class:"cancelled-text"},sa={key:2,class:"locked-text"},la={class:"pagination-wrapper"},oa={class:"confirm-order-content"},na={class:"confirm-icon success"},ra={class:"confirm-info"},da={class:"confirm-date"},ca={class:"confirm-meal"},ia={class:"meal-price"},ua={class:"confirm-total"},_a={class:"total-price"},va={class:"cancel-order-content"},ma={class:"confirm-icon warning"},fa={class:"cancel-detail"},pa={class:"cancel-item"},ga={class:"label"},ya={class:"value"},ha={class:"cancel-item"},wa={class:"label"},Da={class:"value"},ka={class:"cancel-item"},Ma={class:"label"},Ya={class:"value price"},Sa={class:"stat-content"},ba={class:"stat-icon bg-blue"},Oa={class:"stat-info"},Ta={class:"stat-value"},Ia={class:"stat-content"},Ca={class:"stat-icon bg-green"},Ea={class:"stat-info"},xa={class:"stat-value"},La={class:"stat-content"},Ra={class:"stat-icon bg-orange"},za={class:"stat-info"},Va={class:"stat-value"},Aa={class:"stat-content"},Na={class:"stat-icon bg-purple"},Ha={class:"stat-info"},Ua={class:"stat-value"},Pa={__name:"OrderManage",setup(le){u.locale("zh-cn");const I=new Tt,X=x(()=>{const t=localStorage.getItem("user");if(t)try{return JSON.parse(t)}catch(e){return console.error("解析用户信息失败:",e),null}return null}),T={SELECTED_MEAL_TYPE:"canteen_selected_meal_type",TEMP_ORDER_DATA:"canteen_temp_order_data",VIEW_MODE:"canteen_view_mode"},E=_("calendar"),k=_(u()),p=_(""),C=_(null),v=_(null),W=_(!1),J=_(!1),oe=_(!1),ne=_(!1),re=_(!1),de=_(!1),Z=_(!1),q=_(!1),A=_(null),$=_([]),ce=_([]),b=_([]),De=_([]),ke=_(0),ie=_(1),ue=_(10),Me=u(),F=_([Me.startOf("month").toDate(),Me.endOf("month").toDate()]),Ye=_({restaurantId:""}),ze={restaurantId:[{required:!0,message:"请选择食堂",trigger:"change"}]},_e=_({lockTime:"16:00"}),Ve=_(null),ee=_(null),Ae=x(()=>$.value.find(t=>t.id===C.value)),j=x(()=>ce.value.find(t=>t.id===v.value)),Ne=x(()=>{const t=[],e=new Set;if(console.log("availableRestaurants computed - userRestaurantId:",ee.value),console.log("availableRestaurants computed - restaurants:",$.value),ee.value){const s=$.value.find(r=>r.id===ee.value);s&&(t.push({...s,isDefault:!0}),e.add(s.id))}return $.value.forEach(s=>{s.crossDepartmentBooking===1&&!e.has(s.id)&&(t.push({...s,isDefault:!1}),e.add(s.id))}),console.log("availableRestaurants computed - result:",t),t}),He=x(()=>k.value.format("YYYY年MM月")),Ue=["一","二","三","四","五","六","日"],Pe=x(()=>{const t=k.value.year(),e=k.value.month(),s=u().year(t).month(e).date(1),r=s.endOf("month"),d=s.day()===0?s.subtract(6,"day"):s.subtract(s.day()-1,"day"),M=r.day()===0?r.add(0,"day"):r.add(7-r.day(),"day"),h=[];let m=d;for(;m.isBefore(M)||m.isSame(M,"day");){const w=m.format("YYYY-MM-DD"),Y=Se(w),L=v.value&&Y.some(N=>N.mealTypeId===v.value);h.push({date:m,dateStr:w,dayOfMonth:m.date(),isCurrentMonth:m.month()===e,isToday:m.isSame(u(),"day"),hasOrder:Y.length>0,hasCurrentMealTypeOrder:L,orders:Y,canOrder:$e(w),isLocked:Fe(w)}),m=m.add(1,"day")}return h}),ve=x(()=>{const t=k.value.startOf("month"),e=k.value.endOf("month");return b.value.filter(s=>{const r=u(s.orderDate);return r.isAfter(t)&&r.isBefore(e)})}),Be=x(()=>ve.value.filter(t=>t.status===1).length),We=x(()=>ve.value.filter(t=>t.status===1).reduce((t,e)=>t+(e.price||0),0).toFixed(2)),Je=x(()=>{const t=u().startOf("day");return b.value.filter(e=>{const s=u(e.orderDate);return e.status===1&&(s.isAfter(t)||s.isSame(t,"day"))}).length}),Se=t=>b.value.filter(e=>e.orderDate===t&&e.status===1),$e=t=>{const e=u(t),r=u().startOf("day").add(1,"day");if(e.isBefore(r))return!1;if(e.isSame(r,"day")){const d=u(),M=_e.value.lockTime||"16:00",[h,m]=M.split(":").map(Number),w=u().hour(h).minute(m).second(0);if(d.isAfter(w))return!1}return!0},Fe=t=>{const e=u(t),s=u().startOf("day");return e.isBefore(s)},be=t=>{const e=u(t),r=u().startOf("day").add(1,"day");if(e.isBefore(r))return!1;if(e.isSame(r,"day")){const d=u(),M=_e.value.lockTime||"16:00",[h,m]=M.split(":").map(Number),w=u().hour(h).minute(m).second(0);if(d.isAfter(w))return!1}return!0},je=async()=>{try{const t=await B.get("/api/system/config/order");t.success&&t.data&&(_e.value.lockTime=t.data.lockTime||"16:00")}catch(t){console.error("加载系统配置失败:",t)}},qe=async()=>{try{de.value=!0,console.log("loadRestaurants - start");const t=await B.get("/api/admin/restaurant/list");console.log("loadRestaurants - response:",t),t.success?($.value=t.data,console.log("loadRestaurants - loaded restaurants:",$.value)):D.error("加载餐厅列表失败: "+(t.message||"未知错误"))}catch(t){console.error("加载餐厅列表错误:",t),D.error("加载餐厅列表失败: "+(t.message||"网络错误"))}finally{de.value=!1}},Ge=()=>{try{const t=localStorage.getItem("user");if(console.log("loadUserInfo - userStr:",t),t){const e=JSON.parse(t);console.log("loadUserInfo - parsed user:",e),e&&e.departmentId&&(Ve.value=e.departmentId),e&&e.restaurantId&&(ee.value=e.restaurantId,C.value=e.restaurantId,Ye.value.restaurantId=e.restaurantId,console.log("loadUserInfo - set restaurantId:",e.restaurantId))}}catch(t){console.error("加载用户信息错误:",t)}},Ke=t=>{if(!t.status){D.warning("该餐食类型当前暂停供应");return}v.value=t.id,localStorage.setItem(T.SELECTED_MEAL_TYPE,JSON.stringify({id:t.id,timestamp:Date.now()})),G(),D.success({message:`已选择: ${t.name}，日历状态已更新`,duration:2e3,showClose:!0})},Qe=t=>{var e;if(p.value=t.dateStr,G(),t.hasCurrentMealTypeOrder){const s=Se(t.dateStr);if(s.length>0){const r=s.find(d=>d.mealTypeId===v.value)||s[0];be(t.dateStr)?(A.value=r,q.value=!0):D.info({message:"无法取消订餐",duration:2e3})}}else if(t.canOrder){if(!v.value){D.warning({message:"请先选择餐食类型",duration:2e3,showClose:!0}),(e=document.querySelector(".meal-type-card"))==null||e.scrollIntoView({behavior:"smooth",block:"center"});return}Z.value=!0}else!t.canOrder&&!t.isLocked&&D.warning({message:"当前已超过锁单时间，无法进行订餐操作",duration:3e3,showClose:!0})},Xe=async()=>{var t,e,s,r,d,M;if(!C.value){D.warning({message:"请先选择食堂",duration:2e3});return}if(!v.value||!p.value){D.warning({message:"请选择餐食类型和日期",duration:2e3});return}W.value=!0;try{I.saveState(b.value);const h={id:`temp_${Date.now()}`,userId:(t=X.value)==null?void 0:t.id,restaurantId:C.value,restaurantName:(e=Ae.value)==null?void 0:e.name,mealTypeId:v.value,mealTypeName:(s=j.value)==null?void 0:s.name,price:(r=j.value)==null?void 0:r.price,orderDate:p.value,status:1,createdAt:new Date().toISOString()};b.value.push(h),Z.value=!1,D.success({message:"订餐成功！",duration:2e3,showClose:!0});const m=await B.post("/api/order/create",{restaurantId:C.value,mealTypeId:v.value,orderDate:p.value});if(m.success){const w=b.value.findIndex(Y=>Y.id===h.id);w!==-1&&(b.value[w].id=m.orderId||h.id),I.clearHistory(),st()}else{const w=I.restoreState();w&&(b.value=w),D.error({message:m.message||"订餐失败",duration:3e3,showClose:!0})}}catch(h){console.error("订餐失败:",h);const m=I.restoreState();m&&(b.value=m),D.error({message:"订餐失败："+(((M=(d=h.response)==null?void 0:d.data)==null?void 0:M.message)||h.message||"网络错误"),duration:3e3,showClose:!0})}finally{W.value=!1}},Ze=t=>{A.value=t,q.value=!0},et=async()=>{var t,e;if(A.value){W.value=!0;try{I.saveState(b.value);const s=A.value.id;b.value=b.value.filter(d=>d.id!==s),q.value=!1,D.success({message:"订单已取消",duration:2e3,showClose:!0});const r=await B.delete(`/api/order/delete/${s}`);if(r.success)A.value=null,I.clearHistory();else{const d=I.restoreState();d&&(b.value=d),D.error({message:r.message||"取消失败",duration:3e3,showClose:!0})}}catch(s){console.error("取消订单失败:",s);const r=I.restoreState();r&&(b.value=r),D.error({message:"取消失败："+(((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.message)||s.message||"网络错误"),duration:3e3,showClose:!0})}finally{W.value=!1}}},Oe=t=>{k.value=k.value.add(t,"month"),G()},tt=()=>{k.value=u(),p.value=u().format("YYYY-MM-DD"),G()},G=()=>{const t={currentDate:k.value.format("YYYY-MM-DD"),selectedDate:p.value,viewMode:E.value,timestamp:Date.now()};localStorage.setItem(T.TEMP_ORDER_DATA,JSON.stringify(t))},at=()=>{try{const t=localStorage.getItem(T.VIEW_MODE);t&&(E.value=t);const e=localStorage.getItem(T.SELECTED_MEAL_TYPE);if(e){const r=JSON.parse(e);Date.now()-r.timestamp<24*60*60*1e3?v.value=r.id:localStorage.removeItem(T.SELECTED_MEAL_TYPE)}const s=localStorage.getItem(T.TEMP_ORDER_DATA);if(s){const r=JSON.parse(s);Date.now()-r.timestamp<60*60*1e3?(r.currentDate&&(k.value=u(r.currentDate)),r.selectedDate&&(p.value=r.selectedDate),r.viewMode&&(E.value=r.viewMode)):localStorage.removeItem(T.TEMP_ORDER_DATA)}}catch(t){console.error("加载临时数据失败:",t)}},st=()=>{localStorage.removeItem(T.TEMP_ORDER_DATA)},me=t=>({早餐:"#e6a23c",午餐:"#67c23a",晚餐:"#409eff",夜宵:"#f56c6c"})[t]||"#909399",Te=t=>t?u(t).format("YYYY年MM月DD日 dddd"):"",lt=t=>u(t).format("MM-DD"),ot=t=>{const e=["周一","周二","周三","周四","周五","周六","周日"],s=u(t).day();return e[s===0?6:s-1]},nt=async()=>{var t,e;re.value=!0;try{const s=await B.get("/api/order/meal-types");((t=s.data)!=null&&t.success||s.success)&&(ce.value=((e=s.data)==null?void 0:e.data)||s.data||[])}catch(s){console.error("加载餐食类型失败:",s),D.error("加载餐食类型失败")}finally{re.value=!1}},Ie=async()=>{var t,e;oe.value=!0,J.value=!0;try{const s=k.value.year(),r=k.value.month(),d=u().year(s).month(r).date(1),M=d.endOf("month"),h=d.day()===0?d.subtract(6,"day"):d.subtract(d.day()-1,"day"),m=M.day()===0?M.add(0,"day"):M.add(7-M.day(),"day"),w=h.format("YYYY-MM-DD"),Y=m.format("YYYY-MM-DD"),L=await B.get("/api/order/list",{params:{startDate:w,endDate:Y}});((t=L.data)!=null&&t.success||L.success)&&(b.value=((e=L.data)==null?void 0:e.data)||L.data||[])}catch(s){console.error("加载订单失败:",s),D.error("加载订单数据失败")}finally{oe.value=!1,J.value=!1}},te=async()=>{var t,e,s;ne.value=!0;try{const r={page:ie.value,pageSize:ue.value};F.value&&F.value.length===2&&(r.startDate=u(F.value[0]).format("YYYY-MM-DD"),r.endDate=u(F.value[1]).format("YYYY-MM-DD"));const d=await B.get("/api/order/page",{params:r});((t=d.data)!=null&&t.success||d.success)&&(De.value=((e=d.data)==null?void 0:e.data)||d.data||[],ke.value=((s=d.data)==null?void 0:s.total)||d.total||0)}catch(r){console.error("加载订单列表失败:",r),D.error("加载订单列表失败")}finally{ne.value=!1}};return mt(async()=>{if(at(),await je(),Ge(),qe(),nt(),Ie(),te(),!p.value){const t=u();p.value=t.format("YYYY-MM-DD")}}),ft(()=>{I.clearHistory()}),pe(k,()=>{Ie()}),pe(v,()=>{}),pe(E,t=>{localStorage.setItem(T.VIEW_MODE,t),G()}),(t,e)=>{const s=y("el-icon"),r=y("el-radio-button"),d=y("el-radio-group"),M=y("el-option"),h=y("el-select"),m=y("el-form-item"),w=y("el-form"),Y=y("el-card"),L=y("el-tag"),N=y("el-button"),fe=y("el-alert"),rt=y("el-date-picker"),U=y("el-table-column"),dt=y("el-table"),ct=y("el-pagination"),it=y("el-divider"),Ce=y("el-dialog"),ae=y("el-col"),ut=y("el-row"),H=pt("loading");return i(),S("div",It,[a("div",Ct,[e[11]||(e[11]=a("h2",{class:"page-title"},"订单管理",-1)),l(d,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=n=>E.value=n),size:"small",class:"view-toggle"},{default:o(()=>[l(r,{label:"calendar"},{default:o(()=>[l(s,null,{default:o(()=>[l(g(ye))]),_:1}),e[9]||(e[9]=a("span",{class:"btn-text"},"日历视图",-1))]),_:1}),l(r,{label:"list"},{default:o(()=>[l(s,null,{default:o(()=>[l(g(gt))]),_:1}),e[10]||(e[10]=a("span",{class:"btn-text"},"列表视图",-1))]),_:1})]),_:1},8,["modelValue"])]),z((i(),O(Y,{class:"meal-type-card restaurant-card",shadow:"never"},{default:o(()=>[l(w,{model:Ye.value,rules:ze,ref:"orderFormRef","label-width":"80px"},{default:o(()=>[l(m,{label:"食堂",prop:"restaurantId"},{default:o(()=>[l(h,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=n=>C.value=n),placeholder:"选择食堂",style:{width:"100%"},disabled:t.loadingRestaurants},{default:o(()=>[(i(!0),S(K,null,Q(Ne.value,n=>(i(),O(M,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),_:1})),[[H,de.value]]),z((i(),O(Y,{class:"meal-type-card",shadow:"never"},{default:o(()=>[a("div",Et,[(i(!0),S(K,null,Q(ce.value,n=>(i(),S("div",{key:n.id,class:he(["meal-type-item",{active:v.value===n.id,disabled:!n.status}]),onClick:c=>Ke(n)},[a("div",{class:"meal-type-icon",style:ge({backgroundColor:me(n.name)})},[l(s,null,{default:o(()=>[l(g(se))]),_:1})],4),a("div",Lt,[a("div",Rt,f(n.name),1),a("div",zt,"¥"+f(n.price),1)]),a("div",Vt,[v.value===n.id?(i(),O(s,{key:0,class:"check-icon"},{default:o(()=>[l(g(xe))]),_:1})):n.status?we("",!0):(i(),O(L,{key:1,type:"info",size:"small",effect:"plain"},{default:o(()=>[...e[12]||(e[12]=[V("暂停",-1)])]),_:1}))])],10,xt))),128))])]),_:1})),[[H,re.value]]),z((i(),O(Y,{class:"calendar-card",shadow:"never"},{header:o(()=>[a("div",At,[a("div",Nt,[l(N,{circle:"",size:"small",onClick:e[2]||(e[2]=n=>Oe(-1))},{default:o(()=>[l(s,null,{default:o(()=>[l(g(yt))]),_:1})]),_:1}),a("span",Ht,f(He.value),1),l(N,{circle:"",size:"small",onClick:e[3]||(e[3]=n=>Oe(1))},{default:o(()=>[l(s,null,{default:o(()=>[l(g(ht))]),_:1})]),_:1}),l(N,{size:"small",onClick:tt,class:"today-btn",type:"primary",plain:""},{default:o(()=>[...e[13]||(e[13]=[V(" 今天 ",-1)])]),_:1})]),e[14]||(e[14]=a("div",{class:"legend"},[a("span",{class:"legend-item"},[a("span",{class:"legend-dot ordered"}),a("span",{class:"legend-text"},"已订餐")]),a("span",{class:"legend-item"},[a("span",{class:"legend-dot can-order"}),a("span",{class:"legend-text"},"可订餐")]),a("span",{class:"legend-item"},[a("span",{class:"legend-dot locked"}),a("span",{class:"legend-text"},"已过期")])],-1))])]),default:o(()=>{var n;return[a("div",Ut,[a("div",Pt,[(i(),S(K,null,Q(Ue,c=>a("div",{key:c,class:"weekday"},f(c),1)),64))]),a("div",Bt,[(i(!0),S(K,null,Q(Pe.value,(c,P)=>(i(),S("div",{key:P,class:he(["calendar-day",{"other-month":!c.isCurrentMonth,today:c.isToday,ordered:c.hasOrder,"can-order":c.canOrder&&v.value&&!c.hasOrder,locked:c.isLocked,selected:p.value===c.dateStr}]),onClick:R=>Qe(c)},[a("div",Jt,f(c.dayOfMonth),1),c.hasOrder?(i(),S("div",$t,[(i(!0),S(K,null,Q(c.orders.slice(0,2),R=>(i(),S("div",{key:R.id,class:he(["order-badge",{"current-type":R.mealTypeId===v.value}]),style:ge({backgroundColor:R.mealTypeId===v.value?me(R.mealTypeName):"#909399"})},f(R.mealTypeName),7))),128)),c.orders.length>2?(i(),S("span",Ft,"+"+f(c.orders.length-2),1)):we("",!0)])):c.canOrder&&v.value?(i(),S("div",jt,[l(s,{class:"add-icon"},{default:o(()=>[l(g(wt))]),_:1}),e[15]||(e[15]=a("span",{class:"order-text"},"点击订餐",-1))])):c.canOrder&&!v.value?(i(),S("div",qt,[l(s,{class:"select-icon"},{default:o(()=>[l(g(Dt))]),_:1})])):c.isLocked?(i(),S("div",Gt,[l(s,{class:"lock-icon"},{default:o(()=>[l(g(kt))]),_:1}),e[16]||(e[16]=a("span",{class:"locked-text"},"已过期",-1))])):we("",!0)],10,Wt))),128))])]),a("div",Kt,[v.value?(i(),O(fe,{key:1,title:`当前选择: ${((n=j.value)==null?void 0:n.name)||"未知"} - 点击未订餐日期可创建订单，点击已订餐日期可取消订单`,type:"success",closable:!1,"show-icon":""},null,8,["title"])):(i(),O(fe,{key:0,title:"请先选择上方的餐食类型，然后点击日期进行订餐",type:"info",closable:!1,"show-icon":""}))])]}),_:1})),[[Ee,E.value==="calendar"],[H,oe.value]]),z(l(Y,{class:"list-card",shadow:"never"},{header:o(()=>[a("div",Qt,[e[17]||(e[17]=a("span",null,"订单列表",-1)),l(rt,{modelValue:F.value,"onUpdate:modelValue":e[4]||(e[4]=n=>F.value=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small",onChange:te},null,8,["modelValue"])])]),default:o(()=>[z((i(),O(dt,{data:De.value,stripe:"",border:""},{default:o(()=>[l(U,{prop:"orderDate",label:"日期",width:"100"},{default:o(n=>[a("div",Xt,[a("div",Zt,f(lt(n.row.orderDate)),1),a("div",ea,f(ot(n.row.orderDate)),1)])]),_:1}),l(U,{prop:"mealTypeName",label:"餐食类型",width:"100"},{default:o(n=>[a("div",{class:"meal-badge",style:ge({backgroundColor:me(n.row.mealTypeName)})},f(n.row.mealTypeName),5)]),_:1}),l(U,{prop:"restaurantName",label:"食堂",width:"120"},{default:o(n=>[a("span",null,f(n.row.restaurantName||"-"),1)]),_:1}),l(U,{prop:"price",label:"价格",width:"80"},{default:o(n=>{var c;return[a("span",ta,"¥"+f(((c=n.row.price)==null?void 0:c.toFixed(2))||"0.00"),1)]}),_:1}),l(U,{prop:"status",label:"状态",width:"80"},{default:o(n=>[l(L,{type:n.row.status===1?"success":"danger",size:"small",effect:"dark"},{default:o(()=>[V(f(n.row.status===1?"有效":"已取消"),1)]),_:2},1032,["type"])]),_:1}),l(U,{prop:"createdAt",label:"创建时间","min-width":"140"}),l(U,{label:"操作",width:"100",fixed:"right"},{default:o(n=>[n.row.status===1&&be(n.row.orderDate)?(i(),O(N,{key:0,type:"danger",size:"small",onClick:c=>Ze(n.row)},{default:o(()=>[...e[18]||(e[18]=[V(" 取消 ",-1)])]),_:1},8,["onClick"])):n.row.status!==1?(i(),S("span",aa,"已取消")):(i(),S("span",sa,"不可取消"))]),_:1})]),_:1},8,["data"])),[[H,ne.value]]),a("div",la,[l(ct,{"current-page":ie.value,"onUpdate:currentPage":e[5]||(e[5]=n=>ie.value=n),"page-size":ue.value,"onUpdate:pageSize":e[6]||(e[6]=n=>ue.value=n),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",total:ke.value,onSizeChange:te,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1},512),[[Ee,E.value==="list"]]),l(Ce,{modelValue:Z.value,"onUpdate:modelValue":e[7]||(e[7]=n=>Z.value=n),title:"确认订餐",width:"340px","close-on-click-modal":!1,"destroy-on-close":"",class:"order-dialog"},{footer:o(()=>[l(N,{type:"primary",onClick:Xe,loading:W.value,size:"default",class:"full-width-btn"},{default:o(()=>[l(s,null,{default:o(()=>[l(g(Le))]),_:1}),e[20]||(e[20]=V(" 确认订餐 ",-1))]),_:1},8,["loading"])]),default:o(()=>{var n,c,P;return[a("div",oa,[a("div",na,[l(s,null,{default:o(()=>[l(g(xe))]),_:1})]),a("div",ra,[a("div",da,[l(s,null,{default:o(()=>[l(g(ye))]),_:1}),a("span",null,f(Te(p.value)),1)]),a("div",ca,[l(s,null,{default:o(()=>[l(g(se))]),_:1}),a("span",null,f((n=j.value)==null?void 0:n.name),1),a("span",ia,"¥"+f((c=j.value)==null?void 0:c.price),1)])]),l(it),a("div",ua,[e[19]||(e[19]=a("span",null,"订单金额:",-1)),a("span",_a,"¥"+f((P=j.value)==null?void 0:P.price),1)])])]}),_:1},8,["modelValue"]),l(Ce,{modelValue:q.value,"onUpdate:modelValue":e[8]||(e[8]=n=>q.value=n),title:"确认取消订单",width:"340px","close-on-click-modal":!1,"destroy-on-close":"",class:"order-dialog"},{footer:o(()=>[l(N,{type:"danger",onClick:et,loading:W.value,size:"default",class:"full-width-btn"},{default:o(()=>[l(s,null,{default:o(()=>[l(g(Mt))]),_:1}),e[25]||(e[25]=V(" 取消订餐 ",-1))]),_:1},8,["loading"])]),default:o(()=>{var n,c,P,R;return[a("div",va,[a("div",ma,[l(s,null,{default:o(()=>[l(g(Yt))]),_:1})]),e[24]||(e[24]=a("p",{class:"cancel-text"},"确定要取消以下订单吗？",-1)),a("div",fa,[a("div",pa,[a("span",ga,[l(s,null,{default:o(()=>[l(g(ye))]),_:1}),e[21]||(e[21]=V(" 日期 ",-1))]),a("span",ya,f(Te((n=A.value)==null?void 0:n.orderDate)),1)]),a("div",ha,[a("span",wa,[l(s,null,{default:o(()=>[l(g(se))]),_:1}),e[22]||(e[22]=V(" 餐食 ",-1))]),a("span",Da,f((c=A.value)==null?void 0:c.mealTypeName),1)]),a("div",ka,[a("span",Ma,[l(s,null,{default:o(()=>[l(g(Re))]),_:1}),e[23]||(e[23]=V(" 金额 ",-1))]),a("span",Ya,"¥"+f((R=(P=A.value)==null?void 0:P.price)==null?void 0:R.toFixed(2)),1)])]),l(fe,{title:"取消后无法恢复，请谨慎操作",type:"warning",closable:!1,"show-icon":"",class:"cancel-warning"})])]}),_:1},8,["modelValue"]),l(ut,{gutter:15,class:"stats-row"},{default:o(()=>[l(ae,{xs:12,sm:6},{default:o(()=>[z((i(),O(Y,{class:"stat-card",shadow:"hover"},{default:o(()=>[a("div",Sa,[a("div",ba,[l(s,null,{default:o(()=>[l(g(se))]),_:1})]),a("div",Oa,[a("div",Ta,f(ve.value.length),1),e[26]||(e[26]=a("div",{class:"stat-label"},"本月订餐",-1))])])]),_:1})),[[H,J.value]])]),_:1}),l(ae,{xs:12,sm:6},{default:o(()=>[z((i(),O(Y,{class:"stat-card",shadow:"hover"},{default:o(()=>[a("div",Ia,[a("div",Ca,[l(s,null,{default:o(()=>[l(g(Le))]),_:1})]),a("div",Ea,[a("div",xa,f(Be.value),1),e[27]||(e[27]=a("div",{class:"stat-label"},"有效订单",-1))])])]),_:1})),[[H,J.value]])]),_:1}),l(ae,{xs:12,sm:6},{default:o(()=>[z((i(),O(Y,{class:"stat-card",shadow:"hover"},{default:o(()=>[a("div",La,[a("div",Ra,[l(s,null,{default:o(()=>[l(g(Re))]),_:1})]),a("div",za,[a("div",Va,"¥"+f(We.value),1),e[28]||(e[28]=a("div",{class:"stat-label"},"本月消费",-1))])])]),_:1})),[[H,J.value]])]),_:1}),l(ae,{xs:12,sm:6},{default:o(()=>[z((i(),O(Y,{class:"stat-card",shadow:"hover"},{default:o(()=>[a("div",Aa,[a("div",Na,[l(s,null,{default:o(()=>[l(g(St))]),_:1})]),a("div",Ha,[a("div",Ua,f(Je.value),1),e[29]||(e[29]=a("div",{class:"stat-label"},"待用餐",-1))])])]),_:1})),[[H,J.value]])]),_:1})]),_:1})])}}},Ja=bt(Pa,[["__scopeId","data-v-3910eb41"]]);export{Ja as default};
