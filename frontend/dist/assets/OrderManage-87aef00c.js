import{o as ae,r as d,G as te,c as N,d as E,f as e,w as l,h as V,b as D,E as f,e as g,k as x,j as _,t as C,H as le,q as B,J as oe,K as se,i as z,_ as re,a4 as ne,a5 as de,a6 as ue,a7 as ie,V as pe}from"./index-a918310c.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";const me={class:"order-manage"},fe={class:"card-header"},_e={class:"total-info"},ge={class:"action-buttons"},be={class:"pagination-container"},ve={class:"dialog-footer"},ye={__name:"OrderManage",setup(he){const S=V(!1),u=z({status:null,userName:""}),i=V([]),b=z({sortField:"createdAt",sortOrder:"desc"}),n=z({page:1,pageSize:10,total:0}),M=V([]),O=V([]),h=V(!1),s=z({id:null,userId:null,username:"",realName:"",mealTypeId:null,orderDate:"",status:1}),v=async()=>{S.value=!0;try{const t={page:n.page,pageSize:n.pageSize,status:u.status,userName:u.userName,sortField:b.sortField,sortOrder:b.sortOrder};i.value&&i.value.length===2&&(t.startDate=i.value[0],t.endDate=i.value[1]);const a=await D.get("/api/admin/order/list",{params:t});a&&a.success?(M.value=a.data,n.total=a.total):f.error((a==null?void 0:a.message)||"获取订单列表失败")}catch(t){console.error("获取订单列表失败:",t),f.error("获取订单列表失败")}finally{S.value=!1}},Y=async()=>{try{const t=await D.get("/api/admin/meal-type/list");t&&t.success&&(O.value=t.data)}catch(t){console.error("获取餐食类型列表失败:",t)}},L=()=>{n.page=1,v()},$=()=>{u.status=null,u.userName="",i.value=[],b.sortField="createdAt",b.sortOrder="desc",n.page=1,v()},A=({prop:t,order:a})=>{t?(b.sortField=t,b.sortOrder=a==="ascending"?"asc":"desc"):(b.sortField="createdAt",b.sortOrder="desc"),v()},P=t=>{n.pageSize=t,n.page=1,v()},R=t=>{n.page=t,v()},j=async()=>{try{const t={status:u.status,userName:u.userName};i.value&&i.value.length===2&&(t.startDate=i.value[0],t.endDate=i.value[1]);const a=await D.get("/api/admin/order/export",{params:t,responseType:"blob"}),m=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=document.createElement("a");r.href=URL.createObjectURL(m),r.download=`订单数据_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(r),r.click(),document.body.removeChild(r),f.success("导出成功")}catch(t){console.error("导出失败:",t),f.error("导出失败")}},q=t=>{s.id=t.id,s.userId=t.userId,s.username=t.username,s.realName=t.realName,s.mealTypeId=t.mealTypeId,s.orderDate=t.orderDate,s.status=t.status,h.value=!0},G=async()=>{try{const t=await D.put("/api/admin/order/update",s);t&&t.success?(f.success("修改成功"),h.value=!1,v()):f.error((t==null?void 0:t.message)||"修改失败")}catch(t){console.error("修改订单失败:",t),f.error("修改失败")}},H=t=>{re.confirm(`确定要删除订单 ${t.id} 吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var a,m;try{const r=await D.delete(`/api/admin/order/delete/${t.id}`);r&&r.success?(f.success("删除成功"),v()):f.error((r==null?void 0:r.message)||"删除失败")}catch(r){console.error("删除订单失败:",r);const p=r.message||((m=(a=r.response)==null?void 0:a.data)==null?void 0:m.message)||"删除失败，请检查网络连接";f.error(p)}}).catch(()=>{})},J=t=>t||"",K=t=>t||"";return ae(()=>{v(),Y()}),(t,a)=>{const m=d("el-option"),r=d("el-select"),p=d("el-form-item"),T=d("el-input"),U=d("el-date-picker"),w=d("el-icon"),y=d("el-button"),F=d("el-form"),I=d("el-card"),c=d("el-table-column"),Q=d("el-tag"),W=d("el-table"),X=d("el-pagination"),Z=d("el-dialog"),ee=te("loading");return N(),E("div",me,[e(I,{class:"filter-card"},{header:l(()=>[...a[11]||(a[11]=[g("div",{class:"card-header"},[g("span",null,"订单筛选")],-1)])]),default:l(()=>[e(F,{model:u,inline:""},{default:l(()=>[e(p,{label:"订单状态"},{default:l(()=>[e(r,{modelValue:u.status,"onUpdate:modelValue":a[0]||(a[0]=o=>u.status=o),placeholder:"全部状态",clearable:"",style:{width:"120px"}},{default:l(()=>[e(m,{label:"有效",value:1}),e(m,{label:"无效",value:0})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"用户姓名"},{default:l(()=>[e(T,{modelValue:u.userName,"onUpdate:modelValue":a[1]||(a[1]=o=>u.userName=o),placeholder:"输入用户姓名",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"日期范围"},{default:l(()=>[e(U,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=o=>i.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),e(p,null,{default:l(()=>[e(y,{type:"primary",onClick:L},{default:l(()=>[e(w,null,{default:l(()=>[e(x(ne))]),_:1}),a[12]||(a[12]=_(" 查询 ",-1))]),_:1}),e(y,{onClick:$},{default:l(()=>[e(w,null,{default:l(()=>[e(x(de))]),_:1}),a[13]||(a[13]=_(" 重置 ",-1))]),_:1}),e(y,{type:"success",onClick:j},{default:l(()=>[e(w,null,{default:l(()=>[e(x(ue))]),_:1}),a[14]||(a[14]=_(" 导出Excel ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(I,{class:"table-card"},{header:l(()=>[g("div",fe,[a[15]||(a[15]=g("span",null,"订单列表",-1)),g("span",_e,"共 "+C(n.total)+" 条记录",1)])]),default:l(()=>[le((N(),B(W,{data:M.value,stripe:"",border:"",style:{width:"100%"},onSortChange:A},{default:l(()=>[e(c,{prop:"id",label:"订单编号",width:"100",sortable:"custom"}),e(c,{prop:"username",label:"用户名",width:"120"}),e(c,{prop:"realName",label:"真实姓名",width:"120"}),e(c,{prop:"departmentName",label:"部门",width:"150"}),e(c,{prop:"restaurantName",label:"食堂",width:"150"}),e(c,{prop:"mealTypeName",label:"餐食类型",width:"120"}),e(c,{prop:"mealPrice",label:"价格",width:"100",sortable:"custom"},{default:l(o=>{var k;return[g("span",null,"¥"+C(((k=o.row.mealPrice)==null?void 0:k.toFixed(2))||"0.00"),1)]}),_:1}),e(c,{prop:"orderDate",label:"订单日期",width:"120",sortable:"custom"},{default:l(o=>[_(C(J(o.row.orderDate)),1)]),_:1}),e(c,{prop:"statusDesc",label:"状态",width:"100"},{default:l(o=>[e(Q,{type:o.row.status===1?"success":"danger"},{default:l(()=>[_(C(o.row.statusDesc),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"createdAt",label:"创建时间",width:"180",sortable:"custom"},{default:l(o=>[_(C(K(o.row.createdAt)),1)]),_:1}),e(c,{label:"操作",width:"180",fixed:"right"},{default:l(o=>[g("div",ge,[e(y,{type:"primary",size:"small",onClick:k=>q(o.row)},{default:l(()=>[e(w,null,{default:l(()=>[e(x(ie))]),_:1}),a[16]||(a[16]=_(" 编辑 ",-1))]),_:1},8,["onClick"]),e(y,{type:"danger",size:"small",onClick:k=>H(o.row)},{default:l(()=>[e(w,null,{default:l(()=>[e(x(pe))]),_:1}),a[17]||(a[17]=_(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ee,S.value]]),g("div",be,[e(X,{"current-page":n.page,"onUpdate:currentPage":a[3]||(a[3]=o=>n.page=o),"page-size":n.pageSize,"onUpdate:pageSize":a[4]||(a[4]=o=>n.pageSize=o),"page-sizes":[10,20,50,100],total:n.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1}),e(Z,{modelValue:h.value,"onUpdate:modelValue":a[10]||(a[10]=o=>h.value=o),title:"编辑订单",width:"500px","close-on-click-modal":!1},{footer:l(()=>[g("span",ve,[e(y,{onClick:a[9]||(a[9]=o=>h.value=!1)},{default:l(()=>[...a[18]||(a[18]=[_("取消",-1)])]),_:1}),e(y,{type:"primary",onClick:G},{default:l(()=>[...a[19]||(a[19]=[_("确定",-1)])]),_:1})])]),default:l(()=>[e(F,{model:s,"label-width":"100px"},{default:l(()=>[e(p,{label:"订单编号"},{default:l(()=>[e(T,{modelValue:s.id,"onUpdate:modelValue":a[5]||(a[5]=o=>s.id=o),disabled:""},null,8,["modelValue"])]),_:1}),e(p,{label:"用户信息"},{default:l(()=>[e(T,{value:s.realName+" ("+s.username+")",disabled:""},null,8,["value"])]),_:1}),e(p,{label:"餐食类型"},{default:l(()=>[e(r,{modelValue:s.mealTypeId,"onUpdate:modelValue":a[6]||(a[6]=o=>s.mealTypeId=o),placeholder:"选择餐食类型",style:{width:"100%"}},{default:l(()=>[(N(!0),E(oe,null,se(O.value,o=>(N(),B(m,{key:o.id,label:o.name+" (¥"+o.price+")",value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"订单日期"},{default:l(()=>[e(U,{modelValue:s.orderDate,"onUpdate:modelValue":a[7]||(a[7]=o=>s.orderDate=o),type:"date",placeholder:"选择订单日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(p,{label:"订单状态"},{default:l(()=>[e(r,{modelValue:s.status,"onUpdate:modelValue":a[8]||(a[8]=o=>s.status=o),placeholder:"选择状态",style:{width:"100%"}},{default:l(()=>[e(m,{label:"有效",value:1}),e(m,{label:"无效",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},De=ce(ye,[["__scopeId","data-v-7ff87106"]]);export{De as default};
