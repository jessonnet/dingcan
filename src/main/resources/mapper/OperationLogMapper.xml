<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.canteen.mapper.OperationLogMapper">

    <select id="queryLogs" resultType="com.canteen.entity.OperationLog">
        SELECT id, user_id, username, operation_type, module, description, request_method, request_url, 
               request_params, old_data, new_data, ip_address, user_agent, status, error_message, 
               execution_time, created_at 
        FROM operation_log 
        WHERE 1=1
        <if test="userId != null">
            AND user_id = #{userId}
        </if>
        <if test="username != null and username != ''">
            AND username LIKE CONCAT('%', #{username}, '%')
        </if>
        <if test="operationType != null and operationType != ''">
            AND operation_type = #{operationType}
        </if>
        <if test="module != null and module != ''">
            AND description LIKE CONCAT('%', #{module}, '%')
        </if>
        <if test="startTime != null">
            AND created_at &gt;= #{startTime}
        </if>
        <if test="endTime != null">
            AND created_at &lt;= #{endTime}
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
        ORDER BY created_at DESC
        LIMIT #{offset}, #{pageSize}
    </select>

    <select id="countLogs" resultType="java.lang.Long">
        SELECT COUNT(*) FROM operation_log 
        WHERE 1=1
        <if test="userId != null">
            AND user_id = #{userId}
        </if>
        <if test="username != null and username != ''">
            AND username LIKE CONCAT('%', #{username}, '%')
        </if>
        <if test="operationType != null and operationType != ''">
            AND operation_type = #{operationType}
        </if>
        <if test="module != null and module != ''">
            AND description LIKE CONCAT('%', #{module}, '%')
        </if>
        <if test="startTime != null">
            AND created_at &gt;= #{startTime}
        </if>
        <if test="endTime != null">
            AND created_at &lt;= #{endTime}
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
    </select>

</mapper>
